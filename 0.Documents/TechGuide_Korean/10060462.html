<!DOCTYPE html>
<html>
    <head>
        <title>Technical Documents(한국어) : 8. Tablespace(TBS)</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Technical Documents(한국어)</a></span>
                            </li>
                                                    <li>
                                <span><a href="Home_7340036.html">Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="10060431.html">Altibase 모니터링 쿼리 가이드</a></span>
                            </li>
                                                    <li>
                                <span><a href="10060447.html">3. 모니터링 요소와 모니터링 쿼리</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Technical Documents(한국어) : 8. Tablespace(TBS)
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
    
            Created by <span class='author'> heejung lee</span>, last modified by <span class='editor'> david.cho</span> on Dec 15, 2020
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p><style type='text/css'>/*<![CDATA[*/
div.rbtoc1624409834030 {padding: 0px;}
div.rbtoc1624409834030 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1624409834030 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1624409834030'>
<ul class='toc-indentation'>
<li><a href='#id-8.Tablespace(TBS)-Tablespace(TBS)TS'>Tablespace (TBS)</a>
<ul class='toc-indentation'>
<li><a href='#id-8.Tablespace(TBS)-[TS01]메모리테이블스페이스사용량TS01[맨위로]'>[TS01] 메모리 테이블스페이스 사용량[맨 위로]</a></li>
<li><a href='#id-8.Tablespace(TBS)-[TS02]전체메모리테이블스페이스사용량TS02[맨위로]'>[TS02] 전체 메모리 테이블스페이스 사용량[맨 위로]</a></li>
<li><a href='#id-8.Tablespace(TBS)-[TS03]디스크테이블스페이스사용량TS03[맨위로]'>[TS03] 디스크 테이블스페이스 사용량[맨 위로]</a></li>
<li><a href='#id-8.Tablespace(TBS)-[TS04]디스크언두테이블스페이스사용량'>[TS04] 디스크 언두 테이블스페이스 사용량</a></li>
<li><a href='#id-8.Tablespace(TBS)-[TS05]트랜잭션별언두테이블스페이스사용량'>[TS05] 트랜잭션 별 언두 테이블스페이스 사용량</a></li>
<li><a href='#id-8.Tablespace(TBS)-[TS06]전체테이블스페이스사용량'>[TS06] 전체 테이블스페이스 사용량</a></li>
<li><a href='#id-8.Tablespace(TBS)-[TS07]메모리테이블스페이스데이터파일체크포인트경로'>[TS07] 메모리 테이블스페이스 데이터 파일 체크포인트 경로</a></li>
<li><a href='#id-8.Tablespace(TBS)-[TS08]메모리테이블스페이스데이터파일'>[TS08] 메모리 테이블스페이스 데이터 파일</a></li>
<li><a href='#id-8.Tablespace(TBS)-[TS09]디스크테이블스페이스데이터파일'>[TS09] 디스크 테이블스페이스 데이터 파일</a></li>
<li><a href='#id-8.Tablespace(TBS)-[TS10]디스크테이블스페이스데이터파일별I/O'>[TS10] 디스크 테이블스페이스 데이터 파일 별 I/O</a></li>
<li><a href='#id-8.Tablespace(TBS)-[TS11]디스크테이블스페이스데이터파일별단일페이지ReadI/O'>[TS11] 디스크 테이블스페이스 데이터 파일 별 단일 페이지 Read I/O</a></li>
<li><a href='#id-8.Tablespace(TBS)-[TS12]임시테이블스페이스사용량'>[TS12] 임시 테이블스페이스 사용량</a></li>
<li><a href='#id-8.Tablespace(TBS)-[TS13]트랜잭션별임시테이블스페이스사용량'>[TS13] 트랜잭션 별 임시 테이블스페이스 사용량</a></li>
<li><a href='#id-8.Tablespace(TBS)-[TS14]전체테이블스페이스상태'>[TS14] 전체 테이블스페이스 상태</a></li>
</ul>
</li>
</ul>
</div></p><p> </p><p> </p><h1 id="id-8.Tablespace(TBS)-Tablespace(TBS)TS"><strong style="color: rgb(0,0,0);font-size: 20.0px;line-height: 1.5;">Tablespace (TBS)<span class="confluence-anchor-link" id="id-8.Tablespace(TBS)-TS"></span></strong></h1><hr /><p>테이블스페이스 정보를 확인하기 위한 각 모니터링 요소에 대응하는 쿼리는 아래와 같다.</p><p> </p><h4 id="id-8.Tablespace(TBS)-[TS01]메모리테이블스페이스사용량TS01[맨위로]">[TS01] 메모리 테이블스페이스 사용량<span class="confluence-anchor-link" id="id-8.Tablespace(TBS)-TS01"></span><a href="#id-8.Tablespace(TBS)-TS">[&#47592; &#50948;&#47196;]</a></h4><ul style="list-style-type: square;"><li><p>알티베이스 5.5.1 이상 버전에서 사용할 수 있다. </p></li><li><p>휘발성(VOLATILE) 테이블스페이스 사용량도 볼 수 있게 되었다. <span style="line-height: 1.42857;">알티베이스 </span><span style="line-height: 1.42857;">5.5.1부터 휘발성 메모리 테이블스페이스의 정보를 저장하는  V$VOL_TABLESPACES가 추가되었다.</span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>알티베이스 5.5.1 이상</b></div><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;">SELECT TBS_ID
     , TBS_TYPE
     , TBS_NAME
     , TO_CHAR(MAX/1024/1024, &#39;999,999,999&#39;) &#39;MAX(M)&#39;
     , TO_CHAR(TOTAL/1024/1024, &#39;999,999,999&#39;) &#39;TOTAL(M)&#39;
     , TO_CHAR(ALLOC/1024/1024, &#39;999,999,999&#39;) &#39;ALLOC(M)&#39;
     , TO_CHAR(USED/1024/1024, &#39;999,999,999&#39;) &#39;USED(M)&#39;
     , TO_CHAR((ROUND((USED/1024/1024), 0)/ROUND((TOTAL/1024/1024), 0))*100, &#39;999.99&#39;) &#39;USAGE(%)&#39;
     , STATE
     , AUTOEXTEND
  FROM (SELECT ID TBS_ID
             , DECODE(TYPE, 0, &#39;MEM_SYS_DIC&#39;, 1, &#39;MEM_SYS_DATA&#39;, 2, &#39;MEM_USER_DATA&#39;, 8, &#39;VOL_USER_DATA&#39;) TBS_TYPE
             , NAME TBS_NAME
             , DECODE(M.MAXSIZE, 140737488322560, D.MEM_MAX_DB_SIZE , 0 , T.TOTAL_PAGE_COUNT * T.PAGE_SIZE, M.MAXSIZE) MAX
             , M.ALLOC_PAGE_COUNT * T.PAGE_SIZE TOTAL
             , NVL(M.ALLOC_PAGE_COUNT-M.FREE_PAGE_COUNT, T.TOTAL_PAGE_COUNT)*PAGE_SIZE ALLOC
             , NVL(MT.USED, 0) USED
             , DECODE(T.STATE, 1, &#39;OFFLINE&#39;, 2, &#39;ONLINE&#39;, 5, &#39;OFFLINE BACKUP&#39;, 6, &#39;ONLINE BACKUP&#39;, 128, &#39;DROPPED&#39;, &#39;DISCARDED&#39;) STATE
             , DECODE(M.AUTOEXTEND_MODE, 1, &#39;ON&#39;, &#39;OFF&#39;) &#39;AUTOEXTEND&#39;
          FROM V$DATABASE D
             , V$TABLESPACES T
             , (SELECT SPACE_ID
                     , SPACE_NAME
                     , ALLOC_PAGE_COUNT
                     , FREE_PAGE_COUNT
                     , DECODE(MAX_SIZE, 0, (SELECT VALUE1
                                              FROM V$PROPERTY
                                              WHERE NAME = &#39;VOLATILE_MAX_DB_SIZE&#39;), MAX_SIZE) AS MAXSIZE
                     , AUTOEXTEND_MODE
                  FROM V$VOL_TABLESPACES
                 UNION ALL
                SELECT SPACE_ID
                     , SPACE_NAME
                     , ALLOC_PAGE_COUNT
                     , FREE_PAGE_COUNT
                     , MAXSIZE
                     , AUTOEXTEND_MODE
                  FROM V$MEM_TABLESPACES ) M LEFT OUTER JOIN (SELECT TABLESPACE_ID, SUM((FIXED_USED_MEM + VAR_USED_MEM)) USED
                                                                FROM V$MEMTBL_INFO
                                                               GROUP BY TABLESPACE_ID ) MT ON M.SPACE_ID = MT.TABLESPACE_ID
         WHERE T.ID = M.SPACE_ID) ;</pre>
</div></div></li><li><p>알티베이스 5.3.3 용 쿼리이다. 휘발성 메모리 테이블스페이스 정보는 나오지 않는다.  </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>알티베이스 5.3.3 용 쿼리</b></div><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;">SELECT TBS_ID
     , TBS_TYPE
     , TBS_NAME
     , TO_CHAR(MAX/1024/1024, &#39;999,999,999&#39;) &#39;MAX(M)&#39;
     , TO_CHAR(TOTAL/1024/1024, &#39;999,999,999&#39;) &#39;TOTAL(M)&#39;
     , TO_CHAR(ALLOC/1024/1024, &#39;999,999,999&#39;) &#39;ALLOC(M)&#39;
     , TO_CHAR(USED/1024/1024, &#39;999,999,999&#39;) &#39;USED(M)&#39;
     , TO_CHAR((ROUND((USED/1024/1024), 0)/ROUND((TOTAL/1024/1024), 0))*100, &#39;999.99&#39;) &#39;USAGE(%)&#39;
     , STATE
     , AUTOEXTEND
  FROM (SELECT ID TBS_ID
             , DECODE(TYPE, 0, &#39;MEM_SYS_DIC&#39;, 1, &#39;MEM_SYS_DATA&#39;, 2, &#39;MEM_USER_DATA&#39;, 8, &#39;VOL_USER_DATA&#39;) TBS_TYPE
             , NAME TBS_NAME
             , DECODE(MAXSIZE, 140737488322560, D.MEM_MAX_DB_SIZE, 0, ALLOCATED_PAGE_COUNT*PAGE_SIZE, MAXSIZE) MAX
             , ALLOCATED_PAGE_COUNT * PAGE_SIZE TOTAL
             , NVL(M.ALLOC_PAGE_COUNT-M.FREE_PAGE_COUNT, TOTAL_PAGE_COUNT)*PAGE_SIZE ALLOC
             , MT.USED USED
             , DECODE(STATE, 1, &#39;OFFLINE&#39;, 2, &#39;ONLINE&#39;, 5, &#39;OFFLINE BACKUP&#39;, 6, &#39;ONLINE BACKUP&#39;, 128, &#39;DROPPED&#39;, &#39;DISCARDED&#39;) STATE
             , DECODE(AUTOEXTEND_MODE, 1, &#39;ON&#39;, &#39;OFF&#39;) &#39;AUTOEXTEND&#39;
          FROM V$DATABASE D
             , V$TABLESPACES T
             , V$MEM_TABLESPACES M
             , (SELECT TABLESPACE_ID
                     , SUM((FIXED_USED_MEM + VAR_USED_MEM)) USED
                  FROM V$MEMTBL_INFO
                 GROUP BY TABLESPACE_ID) MT
         WHERE T.ID = M.SPACE_ID
           AND ID = MT.TABLESPACE_ID ) ;</pre>
</div></div></li><li><p>알티베이스 4.3.9 용 쿼리이다.  <br />알티베이스 4 버전에서는 사용자가 메모리 테이블스페이를 생성할 수 있는 기능을 제공하지 않았기 때문에 <span style="white-space: pre-wrap;line-height: 1.42857;">'SYS_TBS_MEMORY'라는 하나의 테이블스페이스만 나온다.</span> </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>알티베이스 4 버전 용 쿼리</b></div><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;">SELECT TBS_NAME
     , TO_CHAR(MAX/1024/1024, &#39;999,999,999&#39;) &#39;MAX(M)&#39;
     , TO_CHAR(TOTAL/1024, &#39;999,999,999&#39;) &#39;TOTAL(M)&#39;
     , TO_CHAR(ALLOC/1024, &#39;999,999,999&#39;) &#39;ALLOC(M)&#39;
     , TO_CHAR(USED/1024/1024, &#39;999,999,999&#39;) &#39;USED(M)&#39;
     , TO_CHAR((ROUND((USED/1024/1024), 0)/ROUND((TOTAL/1024), 0))*100, &#39;999.99&#39;) &#39;USAGE(%)&#39;
  FROM (SELECT &#39;SYS_TBS_MEMORY&#39; TBS_NAME
             , MEM_MAX_DB_SIZE MAX
             , MEM_ALLOC_PAGE_COUNT * 32 TOTAL
             , (MEM_ALLOC_PAGE_COUNT - MEM_FREE_PAGE_COUNT) * 32 ALLOC
             , MTBL.USED USED
          FROM V$DATABASE DB
             , (SELECT SUM(FIXED_USED_MEM+VAR_USED_MEM) AS USED
                  FROM V$MEMTBL_INFO ) MTBL ) ;</pre>
</div></div></li></ul><ul style="list-style-type: square;"><li style="margin-top: 0.0px;"><p><strong>주요 컬럼 설명</strong></p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td colspan="1" class="confluenceTd">TBS_ID</td><td colspan="1" class="confluenceTd"><pre style="white-space: pre-wrap;">테이블스페이스 고유 번호이다.</pre></td></tr><tr><td colspan="1" class="confluenceTd">TBS_TYPE</td><td colspan="1" class="confluenceTd"><pre style="white-space: pre-wrap;">메모리 테이블스페이스 유형. 
0 - 시스템 메모리 테이블스페이스로 데이터베이스 시스템의 운영상 필요한 메타 데이터를 저장하기 위한 테이블스페이스이다.
1 - 시스템 메모리 테이블스페이스로 데이터베이스 생성 시 기본으로 생성되는 데이터를 저장하기 위한 테이블스페이스.
2 - 사용자가 생성한 메모리 테이블스페이스이다.
8 - 사용자가 생성한 휘발성 메모리 테이블스페이스이다.</pre></td></tr><tr><td class="confluenceTd">MAX(M)</td><td class="confluenceTd">메모리 테이블스페이스에서 사용할 수 있는 최대 메모리 크기이다.<pre style="white-space: pre-wrap;">테이블스페이스 생성 시 MAXSIZE 를 지정하지 않는 경우에 '<span style="font-family: Arial , sans-serif;line-height: 1.42857;">'UNDEFINED' 를 출력한다. </span></pre><pre style="margin-top: 0.0px;white-space: pre-wrap;">테이블스페이스 속성이 AUTOEXTEND OFF인 경우 TOTAL(M)을 출력한다.</pre></td></tr><tr><td class="confluenceTd">TOTAL(M)</td><td class="confluenceTd">메모리 테이블스페이스가 현재까지 할당받은 페이지의 합계이다. 즉, 현재까지 할당된 '사용 중인 페이지'와 '빈 페이지'의 합계로 데이터 파일(메모리 체크포인트 이미지 파일) 크기와 같다. 알티베이스 서버를 구동하면 메모리에는 '사용 중인 페이지'만 적재된다. 따라서<span style="line-height: 1.42857;"> 이 값만큼 물리 메모리를 사용하고 있다고 판단하기는 어렵다.</span></td></tr><tr><td class="confluenceTd">ALLOC(M)</td><td class="confluenceTd">메모리 테이블스페이스가 현재까지 할당받은 페이지 중 '빈 페이지'를 제외한 '사용 중인 페이지'만의 합계이다. 예를 들어, 100M 크기의 메모리 테이블에 DROP 또는 TRUNCATE를 수행하면 전체 페이지 합계는 변함없으나 페이지 반납을 통해 '사용 중인 페이지'가 '빈 페이지'가 되므로 이 값이 0에 가깝게 된다.</td></tr><tr><td class="confluenceTd">USED(M)</td><td class="confluenceTd">메모리 테이블스페이스의 '사용 중인 페이지' 중에서 '실제로 데이터가 적재된 페이지'의 합계이다. 예를 들어, ALLOC이 100M 크기인 메모리 테이블에 전체 DELELE를 수행하면 ALLOC은 100M로 변함없으나 USED는 0에 가깝게 된다.</td></tr><tr><td colspan="1" class="confluenceTd"><pre style="white-space: pre-wrap;">USAGE(%)</pre></td><td colspan="1" class="confluenceTd">메모리 테이블스페이스가 '<span>현재까지 할당받은 페이지</span>' 대비 '사용 중인 페이지'에 대한 백분율. (즉, USED/TOTAL)</td></tr><tr><td colspan="1" class="confluenceTd"><pre style="white-space: pre-wrap;">STATE</pre></td><td colspan="1" class="confluenceTd"><pre style="white-space: pre-wrap;">테이블스페이스의 상태. 
1 - 오프라인, 2 - 온라인, 3 - 백업 중인 오프라인 상태의 테이블스페이스, 4 - 백업 중인 온라인 상태의 테이블스페이스, 
128  - 삭제된(dropped) 테이블스페이스<br />1024 - 폐기된(discarded) 테이블스페이스<br />1028 - 백업 중인 폐기된(discarded) 상태의 테이블스페이스</pre></td></tr><tr><td class="confluenceTd">AUTOEXTEND</td><td class="confluenceTd">메모리 테이블스페이스의 자동 확장 여부. / ON(1), OFF(2)</td></tr></tbody></table></div></li></ul><p style="margin-top: 0.0px;"> </p><h4 id="id-8.Tablespace(TBS)-[TS02]전체메모리테이블스페이스사용량TS02[맨위로]"><strong><span style="color: rgb(0,0,0);">[TS02] 전체 메모리 테이블스페이스 사용량</span></strong><span class="confluence-anchor-link" id="id-8.Tablespace(TBS)-TS02"></span><a href="#id-8.Tablespace(TBS)-TS">[&#47592; &#50948;&#47196;]</a></h4><ul style="list-style-type: square;"><li><p>알티베이스 4 이상 버전에서 사용할 수 있다. </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;"> SELECT MEM_MAX_DB_SIZE/1024/1024 &#39;MAX(M)&#39;
     , ROUND(MEM_ALLOC_PAGE_COUNT*32/1024, 2) &#39;TOTAL(M)&#39;
     , TRUNC((MEM_ALLOC_PAGE_COUNT-MEM_FREE_PAGE_COUNT)*32/1024, 2) &#39;ALLOC(M)&#39;
     , (SELECT ROUND(SUM((FIXED_USED_MEM + VAR_USED_MEM))/(1024*1024), 3)
          FROM V$MEMTBL_INFO) &#39;USED(M)&#39;
     , TRUNC(((MEM_ALLOC_PAGE_COUNT-MEM_FREE_PAGE_COUNT)*32*1024)/MEM_MAX_DB_SIZE, 4)*100 &#39;USAGE(%)&#39;
  FROM V$DATABASE ;  </pre>
</div></div></li><li><p><strong>주요 컬럼 설명</strong></p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd">MAX(M)</td><td class="confluenceTd">전체 메모리 테이블스페이스가 최대로 할당 가능한 페이지의 합계로 알티베이스 서버 프로퍼티 MEM_MAX_DB_SIZE에 의해 정의된다.</td></tr><tr><td class="confluenceTd">TOTAL(M)</td><td class="confluenceTd">전체 메모리 테이블스페이스가 현재까지 할당 받은 페이지의 합계이다.</td></tr><tr><td class="confluenceTd">ALLOC(M)</td><td class="confluenceTd">전체 메모리 테이블스페이스가 현재까지 할당 받은 페이지중 '빈 페이지'를 제외한 '사용중인 페이지'만의 합계이다.</td></tr><tr><td class="confluenceTd">USED(M)</td><td class="confluenceTd">전체 메모리 테이블스페이스의 '사용중인 페이지'중에서 '실제로 데이터가 적재된 페이지'의 합계이다.</td></tr><tr><td class="confluenceTd">USAGE(%)</td><td class="confluenceTd">전체 메모리 테이블스페이스가 '최대로 할당 가능한 페이지' 대비 '사용중인 페이지'에 대한 백분율. (즉, ALLOC/MAX)</td></tr></tbody></table></div></li></ul><p> </p><h4 id="id-8.Tablespace(TBS)-[TS03]디스크테이블스페이스사용량TS03[맨위로]">[TS03] 디스크 테이블스페이스 사용량<span class="confluence-anchor-link" id="id-8.Tablespace(TBS)-TS03"></span><a href="#id-8.Tablespace(TBS)-TS">[&#47592; &#50948;&#47196;]</a></h4><p> </p><ul style="list-style-type: square;"><li><p><strong>알티베이스 5.5.1 이상 버전</strong>에서 사용할 수 있다. 다른 버전과 달리 언두 테이블스페이스의 사용량도 확인할 수 있다.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>알티베이스 5.5.1 이상</b></div><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;">SELECT TBS_ID
     , TBS_TYPE
     , TBS_NAME
     , TO_CHAR(MAX/1024/1024, &#39;999,999,999&#39;) &#39;MAX(M)&#39;
     , TO_CHAR(TOTAL/1024/1024, &#39;999,999,999&#39;) &#39;TOTAL(M)&#39;
     , TO_CHAR(ALLOC/1024/1024, &#39;999,999,999&#39;) &#39;ALLOC(M)&#39;
     , TO_CHAR(USED/1024/1024, &#39;999,999,999&#39;) &#39;USED(M)&#39;
     , TO_CHAR((ROUND((USED/1024/1024), 0)/ROUND((MAX/1024/1024), 0))*100, &#39;999.99&#39;) &#39;USAGE(%)&#39;
     , STATE
     , AUTOEXTEND
  FROM (SELECT T.ID TBS_ID
             , DECODE(TYPE, 3, &#39;DISK_SYS_DATA&#39;, 4, &#39;DISK_USER_DATA&#39;, 5, &#39;DISK_SYS_TEMP&#39;, 6, &#39;DISK_USER_TEMP&#39;, 7, &#39;DISK_SYS_UNDO&#39;) TBS_TYPE
             , NAME TBS_NAME
             , D.MAX * PAGE_SIZE MAX
             , TOTAL_PAGE_COUNT * PAGE_SIZE TOTAL
             , DECODE(TYPE, 7, U.TOTAL_EXT_CNT * PROP.EXTENT_SIZE, ALLOCATED_PAGE_COUNT * PAGE_SIZE) ALLOC
             , DECODE(TYPE, 3, NVL(DS.USED, 0) , 4, NVL(DS.USED, 0) , 7, (U.TX_EXT_CNT+U.USED_EXT_CNT+U.UNSTEALABLE_EXT_CNT) * PROP.EXTENT_SIZE , ALLOCATED_PAGE_COUNT * PAGE_SIZE ) USED
             , DECODE(STATE, 1, &#39;OFFLINE&#39;, 2, &#39;ONLINE&#39;, 5, &#39;OFFLINE BACKUP&#39;, 6, &#39;ONLINE BACKUP&#39;, 128, &#39;DROPPED&#39;, &#39;DISCARDED&#39;) STATE
             , D.AUTOEXTEND
          FROM V$TABLESPACES T LEFT OUTER JOIN(SELECT SPACE_ID , SUM(TOTAL_USED_SIZE) USED
                  FROM X$SEGMENT
                 GROUP BY SPACE_ID) DS ON DS.SPACE_ID = T.ID
             , (SELECT SPACEID
                     , SUM(DECODE(MAXSIZE, 0, CURRSIZE, MAXSIZE)) AS MAX
                     , DECODE(MAX(AUTOEXTEND), 1, &#39;ON&#39;, &#39;OFF&#39;) &#39;AUTOEXTEND&#39;
                  FROM V$DATAFILES
                 GROUP BY SPACEID ) D
             , V$DISK_UNDO_USAGE U
             , (SELECT VALUE1 EXTENT_SIZE
                  FROM V$PROPERTY
                 WHERE NAME = &#39;SYS_UNDO_TBS_EXTENT_SIZE&#39;) PROP
         WHERE T.ID = D.SPACEID ) ;</pre>
</div></div></li><li><p><strong>알티베이스 5.3.3, 5.3.5</strong></p></li><li>알티베이스 5 에서 디스크 테이블의 구조 변경으로 디스크 테이블스페이스의 실 사용량(USED)을 구할 수 없고 할당 크기(ALLOC)만을 알 수 있었으나 BUG-31372가 반영 후 실 사용량(USED)을 확인할 수 있게 되었다.</li><li>BUG-31372 가 반영된 버전은 아래와 같다.<ul style="list-style-type: square;"><li>ALTIBASE HDB 5.3.3.33</li><li>ALTIBASE HDB 5.3.5.15</li><li>ALTIBASE HDB 5.5.1.0.3</li></ul></li><li><p>이 버전에서는 언두 테이블스페이스와 임시 테이블스페이스의 실 사용량(USED)을 구할 수 없다.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>알티베이스 5.3.3, 5.3.5 용 쿼리</b></div><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;">SELECT TBS_ID
     , TBS_TYPE
     , TBS_NAME
     , TO_CHAR(MAX/1024/1024, &#39;999,999,999&#39;) &#39;MAX(M)&#39;
     , TO_CHAR(TOTAL/1024/1024, &#39;999,999,999&#39;) &#39;TOTAL(M)&#39;
     , TO_CHAR(ALLOC/1024/1024, &#39;999,999,999&#39;) &#39;ALLOC(M)&#39;
     , TO_CHAR(USED/1024/1024, &#39;999,999,999&#39;) &#39;USED(M)&#39;
     , TO_CHAR((ROUND((USED/1024/1024), 0)/ROUND((MAX/1024/1024), 0))*100, &#39;999.99&#39;) &#39;USAGE(%)&#39;
     , STATE
     , AUTOEXTEND
  FROM (SELECT T.ID TBS_ID
             , DECODE(TYPE, 3, &#39;DISK_SYS_DATA&#39;, 4, &#39;DISK_USER_DATA&#39;, 5, &#39;DISK_SYS_TEMP&#39;, 6, &#39;DISK_USER_TEMP&#39;, 7, &#39;DISK_SYS_UNDO&#39;) TBS_TYPE
             , NAME TBS_NAME
             , D.MAX * PAGE_SIZE MAX
             , TOTAL_PAGE_COUNT*PAGE_SIZE TOTAL
             , DECODE(TYPE, 7, (SELECT (SUM(TOTAL_EXTENT_COUNT*PAGE_COUNT_IN_EXTENT)*PAGE_SIZE)
                                  FROM V$UDSEGS) + 
                               (SELECT (SUM(TOTAL_EXTENT_COUNT*PAGE_COUNT_IN_EXTENT)*PAGE_SIZE)
                                  FROM V$TSSEGS) , /* UNDO */
                               ALLOCATED_PAGE_COUNT*PAGE_SIZE) ALLOC
             , DECODE(TYPE, 3, NVL(DS.USED, 0), 
                            4, NVL(DS.USED, 0) /* SYS_TEMP */
                             , ALLOCATED_PAGE_COUNT*PAGE_SIZE) USED
             , DECODE(STATE, 1, &#39;OFFLINE&#39;, 2, &#39;ONLINE&#39;, 5, &#39;OFFLINE BACKUP&#39;, 6, &#39;ONLINE BACKUP&#39;, 128, &#39;DROPPED&#39;, &#39;DISCARDED&#39;) STATE
             , D.AUTOEXTEND
          FROM V$TABLESPACES T LEFT OUTER JOIN (SELECT SPACE_ID , SUM(TOTAL_USED_SIZE) USED
                  FROM X$SEGMENT
                 GROUP BY SPACE_ID ) DS ON DS.SPACE_ID = T.ID
             ,(SELECT SPACEID
                     , SUM(DECODE(MAXSIZE, 0, CURRSIZE, MAXSIZE)) AS MAX
                     , DECODE(MAX(AUTOEXTEND), 1, &#39;ON&#39;, &#39;OFF&#39;) &#39;AUTOEXTEND&#39;
                  FROM V$DATAFILES
                 GROUP BY SPACEID ) D
         WHERE T.ID = D.SPACEID) ;</pre>
</div></div></li></ul><ul style="list-style-type: square;"><li><p><strong>알티베이스 5.1.5</strong><br />알티베이스 5 에서 디스크 테이블의 구조 변경으로 디스크 테이블스페이스의 실 사용량(USED)을 구할 수 없고 할당 크기(ALLOC)만을 알 수 있다.<br /><span style="line-height: 1.42857;">이 버전에서는 언두 테이블스페이스와 임시 테이블스페이스의 실 사용량을 구할 수 없다.</span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>알티베이스 5.1.5 용 쿼리</b></div><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;">SELECT TBS_ID
     , TBS_TYPE
     , TBS_NAME
     , TO_CHAR(MAX/1024/1024, &#39;999,999,999&#39;) &#39;MAX(M)&#39;
     , TO_CHAR(TOTAL/1024/1024, &#39;999,999,999&#39;) &#39;TOTAL(M)&#39;
     , TO_CHAR(ALLOC/1024/1024, &#39;999,999,999&#39;) &#39;ALLOC(M)&#39;
     , TO_CHAR((ROUND((ALLOC/1024/1024), 0)/ROUND((MAX/1024/1024), 0))*100, &#39;999.99&#39;) &#39;USAGE(%)&#39;
     , STATE
     , AUTOEXTEND
  FROM (SELECT T.ID TBS_ID
             , DECODE(TYPE, 3, &#39;DISK_SYS_DATA&#39;, 4, &#39;DISK_USER_DATA&#39;, 5, &#39;DISK_SYS_TEMP&#39;, 6, &#39;DISK_USER_TEMP&#39;, 7, &#39;DISK_SYS_UNDO&#39;) TBS_TYPE
             , NAME TBS_NAME
             , D.MAX * PAGE_SIZE MAX
             , TOTAL_PAGE_COUNT * PAGE_SIZE TOTAL
             , DECODE(TYPE, 7, (SELECT (SUM(total_page_count) * PAGE_SIZE)
                          FROM V$undo_seg)+ (SELECT (SUM(ALLOC_PAGE_COUNT) * PAGE_SIZE)
                          FROM v$tss_seg))
             , ALLOCATED_PAGE_COUNT * PAGE_SIZE ALLOC
             , DECODE(STATE, 1, &#39;OFFLINE&#39;, 2, &#39;ONLINE&#39;, 5, &#39;OFFLINE BACKUP&#39;, 6, &#39;ONLINE BACKUP&#39;, 128, &#39;DROPPED&#39;, &#39;DISCARDED&#39;) STATE
             , D.AUTOEXTEND
          FROM V$TABLESPACES T
             ,(SELECT SPACEID
                     , SUM(DECODE(MAXSIZE, 0, CURRSIZE, MAXSIZE)) AS MAX
                     , DECODE(MAX(AUTOEXTEND), 1, &#39;ON&#39;, &#39;OFF&#39;) &#39;AUTOEXTEND&#39;
                  FROM V$DATAFILES
                 GROUP BY SPACEID) D
         WHERE T.ID = D.SPACEID) ;</pre>
</div></div></li><li><p><strong>알티베이스 4</strong></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>알티베이스 4 버전 용 쿼리</b></div><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;">SELECT TBS_ID
     , TBS_TYPE
     , TBS_NAME
     , TO_CHAR(MAX/1024/1024, &#39;999,999,999&#39;) &#39;MAX(M)&#39;
     , TO_CHAR(TOTAL/1024/1024, &#39;999,999,999&#39;) &#39;TOTAL(M)&#39;
     , TO_CHAR(ALLOC/1024/1024, &#39;999,999,999&#39;) &#39;ALLOC(M)&#39;
     , TO_CHAR(USED/1024/1024, &#39;999,999,999&#39;) &#39;USED(M)&#39;
     , TO_CHAR((ROUND((USED/1024/1024), 0)/ROUND((MAX/1024/1024), 0))*100, &#39;999.99&#39;) &#39;USAGE(%)&#39;
     , STATE
     , AUTOEXTEND
  FROM (SELECT TBS.ID TBS_ID
             , DECODE(TYPE, 1, &#39;DISK_SYS_DATA&#39;, 2, &#39;DISK_USER_DATA&#39;, 3, &#39;DISK_SYS_TEMP&#39;, 4, &#39;DISK_USER_TEMP&#39;, 5, &#39;DISK_SYS_UNDO&#39;) TBS_TYPE
             , TBS.NAME TBS_NAME
             , DAT.MAX * TBS.PAGE_SIZE MAX
             , TBS.TOTAL_PAGE_COUNT * TBS.PAGE_SIZE TOTAL
             , DECODE(TBS.TYPE, 5, UNDO.ALLOC * TBS.PAGE_SIZE /* UNDO TABLESPACE*/
                                 , TBS.ALLOCATED_PAGE_COUNT * TBS.PAGE_SIZE) ALLOC
             , DECODE(TBS.TYPE, 3, TBS.ALLOCATED_PAGE_COUNT * TBS.PAGE_SIZE /* TEMP TABLESPACE */
                              , 5, UNDO.USED * TBS.PAGE_SIZE /* UNDO TABLESPACE*/
                                 , DECODE(SEG.USED, &#39;&#39;, 0, (SEG.USED * TBS.PAGE_SIZE * TBS.A_EXTENT_PAGE_COUNT))) /* USER TABLESPACE &amp; SYS_TBS_DATA */USED
             , DECODE(TBS.STATE, 1, &#39;ONLINE&#39;, 2, &#39;BEGIN BACKUP&#39;, 3, &#39;END BACKUP&#39;, &#39;NOT DEFINED&#39;) STATE
             , DAT.AUTOEXTEND
          FROM V$TABLESPACES TBS LEFT OUTER JOIN (SELECT SPACE_ID , SUM(EXTENT_TOTAL_COUNT) ALLOC , SUM(EXTENT_FULL_COUNT ) USED
                  FROM X$SEGMENT
                 GROUP BY SPACE_ID ) SEG ON TBS.ID = SEG.SPACE_ID
             ,(SELECT SPACEID
                     , SUM(DECODE(MAXSIZE, 0, CURRSIZE, MAXSIZE)) AS MAX
                     , DECODE(MAX(AUTOEXTEND), 1, &#39;ON&#39;, &#39;OFF&#39;) &#39;AUTOEXTEND&#39;
                  FROM V$DATAFILES
                 GROUP BY SPACEID ) DAT
             , (SELECT SUM(ALLOCATED_PAGE_COUNT) ALLOC
                     , SUM(USED_PAGE_COUNT) USED
                  FROM V$UNDO_TBS ) UNDO
         WHERE TBS.ID = DAT.SPACEID );</pre>
</div></div></li><li><p><strong>주요 컬럼 설명</strong></p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd">MAX(M)</td><td class="confluenceTd">디스크 테이블스페이스가 최대로 할당 가능한 페이지의 합계로 페이지는 '사용 중인 페이지'와 '빈 페이지'로 구분된다.</td></tr><tr><td class="confluenceTd">TOTAL(M)</td><td class="confluenceTd">디스크 테이블스페이스가 현재까지 할당받은 페이지의 합계. 즉, 현재까지 할당된 '사용 중인 페이지'와 '빈 페이지'의 합계로 데이터 파일 크기와 대응한다.</td></tr><tr><td class="confluenceTd">ALLOC(M)</td><td class="confluenceTd">디스크 테이블스페이스가 현재까지 할당받은 페이지 중 '빈 페이지'를 제외한 '사용 중인 페이지'만의 합계이다. 예를 들어, 100M 크기의 디스크 테이블에 DROP 또는 TRUNCATE를 수행하면 전체 페이지 합계는 변함없으나 페이지 반납을 통해 '사용 중인 페이지'가 '빈 페이지'가 되므로 이 값이 0에 가깝게 된다.</td></tr><tr><td class="confluenceTd">USED(M)</td><td class="confluenceTd"><p>디스크 테이블스페이스의 '사용 중인 페이지'중에서 '실제 데이터가 적재된 페이지'의 합계이다.<br />하지만, 디스크 테이블스페이스 관리 기법의 변화로 인해 알티베이스 5.1.5부터 5.3.3까지는 확인할 수 없다. <span>알티베이스 </span>5.5 부터는 메모리 테이블스페이스처럼 확인이 가능하다.</p></td></tr><tr><td class="confluenceTd">USAGE(%)</td><td class="confluenceTd">디스크 테이블스페이스가 '최대로 할당 가능한 페이지' 대비 '<span>실제 데이터가 적재된 페이지</span>'에 대한 백분율이다.(즉,USED/MAX)</td></tr></tbody></table></div><p><br /><br /></p></li></ul><p> </p><h4 id="id-8.Tablespace(TBS)-[TS04]디스크언두테이블스페이스사용량"><strong>[TS04] 디스크 언두 테이블스페이스 사용량</strong></h4><ul style="list-style-type: square;"><li><p>아래 쿼리는 알티베이스 5.5.1 부터 사용할 수 있다. </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;">SELECT T.NAME TBS_NAME
     , ROUND(D.MAX * PAGE_SIZE / 1024 /1024, 2) &#39;MAX(M)&#39;                                                                     
     , ROUND((TOTAL_PAGE_COUNT * PAGE_SIZE) / 1024 / 1024, 2) &#39;TOTAL(M)&#39;                                                     
     , ROUND((U.TOTAL_EXT_CNT*PROP.EXTENT_SIZE)/1024/1024, 2) &#39;ALLOC(M)&#39;                                                     
     , ROUND(((U.TX_EXT_CNT+U.USED_EXT_CNT+U.UNSTEALABLE_EXT_CNT) * PROP.EXTENT_SIZE)/1024/1024, 2) &#39;USED(M)&#39;                
     , ROUND((((U.TX_EXT_CNT+U.USED_EXT_CNT+U.UNSTEALABLE_EXT_CNT) * PROP.EXTENT_SIZE)/(D.MAX*PAGE_SIZE))*100, 2) &#39;USAGE(%)&#39; 
     , DECODE(STATE,1,&#39;OFFLINE&#39;,2,&#39;ONLINE&#39;,5,&#39;OFFLINE BACKUP&#39;,6,&#39;ONLINE BACKUP&#39;,128,&#39;DROPPED&#39;, &#39;DISCARDED&#39;) STATE            
     , D.AUTOEXTEND
  FROM V$TABLESPACES T
     , (SELECT SPACEID
             , SUM(DECODE(MAXSIZE, 0, CURRSIZE, MAXSIZE)) AS MAX
             , DECODE(MAX(AUTOEXTEND),1,&#39;ON&#39;,&#39;OFF&#39;) &#39;AUTOEXTEND&#39;
          FROM V$DATAFILES
         GROUP BY SPACEID) D
     , V$DISK_UNDO_USAGE U
     , (SELECT VALUE1 EXTENT_SIZE FROM V$PROPERTY WHERE NAME = &#39;SYS_UNDO_TBS_EXTENT_SIZE&#39;) PROP
 WHERE T.ID = D.SPACEID
   AND T.ID = 3 ;</pre>
</div></div></li></ul><p> </p><ul style="list-style-type: square;"><li><p>주요 컬럼 설명</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><span style="color: rgb(0,0,0);">MAX(M)</span></td><td class="confluenceTd"><span style="color: rgb(0,0,0);">언두 테이블스페이스에서 사용할 수 있는 최대 크기</span></td></tr><tr><td class="confluenceTd"><span style="color: rgb(0,0,0);">TOTAL(M)</span></td><td class="confluenceTd"><span style="color: rgb(0,0,0);">언두 테이블스페이스로 할당 받은 전체 크기</span></td></tr><tr><td class="confluenceTd"><span style="color: rgb(0,0,0);">ALLOC(M)</span></td><td class="confluenceTd"><span style="color: rgb(0,0,0);">현재까지 할당 받은 페이지 중 '빈 페이지'를 제외한 '사용 중인 페이지'만의 합계</span></td></tr><tr><td class="confluenceTd"><span style="color: rgb(0,0,0);">USED(M)</span></td><td class="confluenceTd"><span style="color: rgb(0,0,0);">언두 테이블스페이스의 사용량. 변경 트랜잭션에 의해 사용 중이거나 재사용 할 수 없는 EXTENT 크기</span></td></tr><tr><td class="confluenceTd"><span style="color: rgb(0,0,0);">USAGE(%)</span></td><td class="confluenceTd"><span style="color: rgb(0,0,0);">사용률(MAX 대비 USED)</span></td></tr><tr><td class="confluenceTd"><span style="color: rgb(0,0,0);">STATE</span></td><td class="confluenceTd"><span style="color: rgb(0,0,0);">테이블스페이스 상태</span></td></tr></tbody></table></div></li></ul><p> </p><h4 id="id-8.Tablespace(TBS)-[TS05]트랜잭션별언두테이블스페이스사용량"><strong>[TS05] 트랜잭션 별 언두 테이블스페이스 사용량</strong></h4><ul style="list-style-type: square;"><li><p>아래 쿼리는 알티베이스 5.5.1 부터 사용할 수 있다. </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;">SELECT  DECODE(TX.SESSION_ID, -1, &#39;REP(&#39;||REP.REP_NAME||&#39;)&#39;, TX.SESSION_ID) SESSION_ID
      , TX.ID TX_ID
      , DECODE(TX.STATUS, 0, &#39;BEGIN&#39;, 1, &#39;PRECOMMIT&#39;, 2, &#39;COMMIT_IN_MEMORY&#39;, 3, &#39;COMMIT&#39;, 4, &#39;ABORT&#39;, 5, &#39;BLOCKED&#39;, 6, &#39;END&#39;) TX_STATUS
      , RPAD(DECODE(ST.EXECUTE_FLAG, NULL, &#39;REP(&#39;||REP.REP_NAME||&#39;)&#39;, 1, &#39;SQL ING&#39;, 0, &#39;SQL END&#39;), 10) SQL_STATUS
      , RPAD(DECODE(TX.LOG_TYPE, 1, &#39;REP &#39;||REP.PEER_IP||&#39;:&#39;||REP.PEER_PORT, S.COMM_NAME||&#39; PID:&#39;||S.CLIENT_PID), 40) CLIENT_IP
      , RPAD(DECODE(TX.LOG_TYPE, 1, &#39;REP(&#39;||REP.REP_NAME||&#39;)&#39;, S.CLIENT_APP_INFO), 15) CLIENT_APP_INFO
      , RPAD(DECODE(S.AUTOCOMMIT_FLAG, 1, &#39;ON&#39;, 0, &#39;OFF&#39;, NULL, &#39;REP(&#39;||REP.REP_NAME||&#39;)&#39;), 10) AUTOCOMMIT
      , RPAD(DECODE(TX.LOG_TYPE, 1, &#39;REP(&#39;||REP.REP_NAME||&#39;)&#39;, S.UTRANS_TIME_LIMIT), 15) UTRANS_TIMEOUT
      , DECODE(ST.LAST_QUERY_START_TIME, NULL, TO_CHAR(TO_DATE(&#39;1970010109&#39;, &#39;YYYYMMDDHH&#39;) + TX.FIRST_UPDATE_TIME / (60*60*24), &#39;YYYY-MM-DD HH:MI:SS&#39;), TO_CHAR(TO_DATE(&#39;1970010109&#39;, &#39;YYYYMMDDHH&#39;) + ST.LAST_QUERY_START_TIME / (60*60*24), &#39;YYYY-MM-DD HH:MI:SS&#39;)) LAST_QUERY_START_TIME
      , ((((TSS.TOTAL_EXTENT_COUNT+TSS.TOTAL_EXTDIR_COUNT)*TSS.PAGE_COUNT_IN_EXTENT)+((UDS.TOTAL_EXTENT_COUNT+UDS.TOTAL_EXTDIR_COUNT)*UDS.PAGE_COUNT_IN_EXTENT))*TBS.PAGE_SIZE) /1024/1024 UNDO_USAGE
      , DECODE(TX.LOG_TYPE, 1, &#39;REMOTE_TX_ID : &#39;||REP_TX.REMOTE_TID, SUBSTR(ST.QUERY, 1, 30)) QUERY
  FROM  V$TXSEGS TXS
      , V$TSSEGS TSS
      , V$UDSEGS UDS
      , V$TRANSACTION TX LEFT OUTER JOIN V$SESSION S ON TX.ID = S.TRANS_ID LEFT OUTER JOIN V$STATEMENT ST ON S.CURRENT_STMT_ID = ST.ID LEFT OUTER JOIN V$REPRECEIVER_TRANSTBL REP_TX ON TX.ID = REP_TX.LOCAL_TID LEFT OUTER JOIN V$REPRECEIVER REP ON REP_TX.REP_NAME = REP.REP_NAME
      , V$TABLESPACES TBS
 WHERE 1=1
   AND UDS.SPACE_ID = 3
   AND TXS.ID = UDS.TXSEG_ENTRY_ID
   AND TXS.ID = TSS.TXSEG_ENTRY_ID
   AND TXS.TRANS_ID = TX.ID
   AND TBS.ID = UDS.SPACE_ID
 ;</pre>
</div></div></li><li><p><strong>주요 컬럼 설명</strong></p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><span style="color: rgb(0,0,0);">SESSION_ID</span></td><td class="confluenceTd"><span style="color: rgb(0,0,0);">트랜잭션을 수행한 세션 ID 또는 이중화 객체 이름</span></td></tr><tr><td class="confluenceTd"><span style="color: rgb(0,0,0);">TX_ID</span></td><td class="confluenceTd"><span style="color: rgb(0,0,0);">트랜잭션 ID</span></td></tr><tr><td class="confluenceTd"><span style="color: rgb(0,0,0);">TX_STATUS</span></td><td class="confluenceTd"><span style="color: rgb(0,0,0);">트랜잭션 상태</span></td></tr><tr><td class="confluenceTd"><span style="color: rgb(0,0,0);">SQL_STATUS</span></td><td class="confluenceTd"><span style="color: rgb(0,0,0);">SQL문 상태</span></td></tr><tr><td class="confluenceTd"><span style="color: rgb(0,0,0);">CLIENT_IP</span></td><td class="confluenceTd"><span style="color: rgb(0,0,0);">클라이언트 IP와 프로세스 ID</span></td></tr><tr><td class="confluenceTd"><span style="color: rgb(0,0,0);">AUTOCOMMIT</span></td><td class="confluenceTd"><span style="color: rgb(0,0,0);">세션의 AUTOCOMMIT 모드</span></td></tr><tr><td class="confluenceTd"><span style="color: rgb(0,0,0);">UTRANS_TIMEOUT</span></td><td class="confluenceTd"><span style="color: rgb(0,0,0);">세션의 UTRANS_TIMEOUT 설정값</span></td></tr><tr><td class="confluenceTd"><span style="color: rgb(0,0,0);">LAST_QUERY_START_TIME</span></td><td class="confluenceTd"><span style="color: rgb(0,0,0);">SQL문 시작 시각</span></td></tr><tr><td class="confluenceTd"><span style="color: rgb(0,0,0);">UNDO_USAGE</span></td><td class="confluenceTd"><span style="color: rgb(0,0,0);">트랜잭션의 언두 사용량(MB단위)</span></td></tr><tr><td class="confluenceTd"><span style="color: rgb(0,0,0);">QUERY</span></td><td class="confluenceTd"><span style="color: rgb(0,0,0);">언두를 사용하거나 접근한 트랜잭션에서 수행한 마지막 쿼리</span></td></tr></tbody></table></div></li></ul><p> </p><h4 id="id-8.Tablespace(TBS)-[TS06]전체테이블스페이스사용량">[TS06] 전체 테이블스페이스 사용량</h4><ul><li><p>아래는 알티베이스 5.5.1 이상 버전에서 사용할 수 있다.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;">SELECT TBS_ID
     , TBS_TYPE
     , TBS_NAME
     , TO_CHAR(MAX/1024/1024, &#39;999,999,999&#39;) &#39;MAX(M)&#39;
     , TO_CHAR(TOTAL/1024, &#39;999,999,999&#39;) &#39;TOTAL(M)&#39;
     , TO_CHAR(ALLOC/1024, &#39;999,999,999&#39;) &#39;ALLOC(M)&#39;
     , TO_CHAR(USED/1024/1024, &#39;999,999,999&#39;) &#39;USED(M)&#39;
     , TO_CHAR((ROUND((TOTAL/1024), 0)/ROUND((MAX/1024/1024), 0))*100, &#39;999.99&#39;) &#39;USAGE(%)&#39;
      , &#39;&#39; STATE
      , &#39;&#39; &#39;AUTOEXTEND&#39;
  FROM (SELECT &#39;&#39; TBS_ID
             , &#39;ALL_MEM_TBS&#39; TBS_TYPE
             , &#39;-&#39; TBS_NAME
             , MEM_MAX_DB_SIZE MAX
             , MEM_ALLOC_PAGE_COUNT*32 TOTAL
             , (MEM_ALLOC_PAGE_COUNT-MEM_FREE_PAGE_COUNT)*32 ALLOC
             , (SELECT SUM(FIXED_USED_MEM + VAR_USED_MEM)
                  FROM V$MEMTBL_INFO) USED
          FROM V$DATABASE )
UNION ALL
SELECT TBS_ID
     , TBS_TYPE
     , TBS_NAME
     , TO_CHAR(MAX/1024/1024, &#39;999,999,999&#39;) &#39;MAX(M)&#39;
     , TO_CHAR(TOTAL/1024/1024, &#39;999,999,999&#39;) &#39;TOTAL(M)&#39;
     , TO_CHAR(ALLOC/1024/1024, &#39;999,999,999&#39;) &#39;ALLOC(M)&#39;
     , TO_CHAR(USED/1024/1024, &#39;999,999,999&#39;) &#39;USED(M)&#39;
     , TO_CHAR((ROUND((USED/1024/1024), 0)/ROUND((TOTAL/1024/1024), 0))*100, &#39;999.99&#39;) &#39;USAGE(%)&#39;
     , STATE
     , AUTOEXTEND
  FROM (SELECT ID TBS_ID
             , DECODE(TYPE, 0, &#39;MEM_SYS_DIC&#39;, 1, &#39;MEM_SYS_DATA&#39;, 2, &#39;MEM_USER_DATA&#39;, 8, &#39;VOL_USER_DATA&#39;) TBS_TYPE
             , NAME TBS_NAME
             , DECODE(M.MAXSIZE, 140737488322560, D.MEM_MAX_DB_SIZE , 0 , T.TOTAL_PAGE_COUNT * T.PAGE_SIZE, M.MAXSIZE) MAX
             , M.ALLOC_PAGE_COUNT * T.PAGE_SIZE TOTAL
             , NVL(M.ALLOC_PAGE_COUNT-M.FREE_PAGE_COUNT, T.TOTAL_PAGE_COUNT)*PAGE_SIZE ALLOC
             , NVL(MT.USED, 0) USED
             , DECODE(T.STATE, 1, &#39;OFFLINE&#39;, 2, &#39;ONLINE&#39;, 5, &#39;OFFLINE BACKUP&#39;, 6, &#39;ONLINE BACKUP&#39;, 128, &#39;DROPPED&#39;, &#39;DISCARDED&#39;) STATE
             , DECODE(M.AUTOEXTEND_MODE, 1, &#39;ON&#39;, &#39;OFF&#39;) &#39;AUTOEXTEND&#39;
          FROM V$DATABASE D
             , V$TABLESPACES T
             , (SELECT SPACE_ID
                     , SPACE_NAME
                     , ALLOC_PAGE_COUNT
                     , FREE_PAGE_COUNT
                     , DECODE(MAX_SIZE, 0, (SELECT VALUE1
                                              FROM V$PROPERTY
                                              WHERE NAME = &#39;VOLATILE_MAX_DB_SIZE&#39;), MAX_SIZE) AS MAXSIZE
                     , AUTOEXTEND_MODE
                  FROM V$VOL_TABLESPACES
                 UNION ALL
                SELECT SPACE_ID
                     , SPACE_NAME
                     , ALLOC_PAGE_COUNT
                     , FREE_PAGE_COUNT
                     , MAXSIZE
                     , AUTOEXTEND_MODE
                  FROM V$MEM_TABLESPACES ) M LEFT OUTER JOIN (SELECT TABLESPACE_ID, SUM((FIXED_USED_MEM + VAR_USED_MEM)) USED
                                                                FROM V$MEMTBL_INFO
                                                               GROUP BY TABLESPACE_ID ) MT ON M.SPACE_ID = MT.TABLESPACE_ID
         WHERE T.ID = M.SPACE_ID)
UNION ALL
SELECT TBS_ID
     , TBS_TYPE
     , TBS_NAME
     , TO_CHAR(MAX/1024/1024, &#39;999,999,999&#39;) &#39;MAX(M)&#39;
     , TO_CHAR(TOTAL/1024/1024, &#39;999,999,999&#39;) &#39;TOTAL(M)&#39;
     , TO_CHAR(ALLOC/1024/1024, &#39;999,999,999&#39;) &#39;ALLOC(M)&#39;
     , TO_CHAR(USED/1024/1024, &#39;999,999,999&#39;) &#39;USED(M)&#39;
     , TO_CHAR((ROUND((USED/1024/1024), 0)/ROUND((MAX/1024/1024), 0))*100, &#39;999.99&#39;) &#39;USAGE(%)&#39;
     , STATE
     , AUTOEXTEND
  FROM (SELECT T.ID TBS_ID
             , DECODE(TYPE, 3, &#39;DISK_SYS_DATA&#39;, 4, &#39;DISK_USER_DATA&#39;, 5, &#39;DISK_SYS_TEMP&#39;, 6, &#39;DISK_USER_TEMP&#39;, 7, &#39;DISK_SYS_UNDO&#39;) TBS_TYPE
             , NAME TBS_NAME
             , D.MAX * PAGE_SIZE MAX
             , TOTAL_PAGE_COUNT * PAGE_SIZE TOTAL
             , DECODE(TYPE, 7, U.TOTAL_EXT_CNT * PROP.EXTENT_SIZE, ALLOCATED_PAGE_COUNT * PAGE_SIZE) ALLOC
             , DECODE(TYPE, 3, NVL(DS.USED, 0) , 4, NVL(DS.USED, 0) , 7, (U.TX_EXT_CNT+U.USED_EXT_CNT+U.UNSTEALABLE_EXT_CNT) * PROP.EXTENT_SIZE , ALLOCATED_PAGE_COUNT * PAGE_SIZE ) USED
             , DECODE(STATE, 1, &#39;OFFLINE&#39;, 2, &#39;ONLINE&#39;, 5, &#39;OFFLINE BACKUP&#39;, 6, &#39;ONLINE BACKUP&#39;, 128, &#39;DROPPED&#39;, &#39;DISCARDED&#39;) STATE
             , D.AUTOEXTEND
          FROM V$TABLESPACES T LEFT OUTER JOIN(SELECT SPACE_ID , SUM(TOTAL_USED_SIZE) USED
                  FROM X$SEGMENT
                 GROUP BY SPACE_ID) DS ON DS.SPACE_ID = T.ID
             , (SELECT SPACEID
                     , SUM(DECODE(MAXSIZE, 0, CURRSIZE, MAXSIZE)) AS MAX
                     , DECODE(MAX(AUTOEXTEND), 1, &#39;ON&#39;, &#39;OFF&#39;) &#39;AUTOEXTEND&#39;
                  FROM V$DATAFILES
                 GROUP BY SPACEID ) D
             , V$DISK_UNDO_USAGE U
             , (SELECT VALUE1 EXTENT_SIZE
                  FROM V$PROPERTY
                 WHERE NAME = &#39;SYS_UNDO_TBS_EXTENT_SIZE&#39;) PROP
         WHERE T.ID = D.SPACEID ) ;</pre>
</div></div></li><li><p>주요 컬럼 설명</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><span style="color: rgb(0,0,0);">MAX(M)</span></td><td class="confluenceTd"><span style="color: rgb(0,0,0);">언두 테이블스페이스에서 사용할 수 있는 최대 크기</span></td></tr><tr><td class="confluenceTd"><span style="color: rgb(0,0,0);">TOTAL(M)</span></td><td class="confluenceTd"><span style="color: rgb(0,0,0);">테이블스페이스가 현재까지 할당받은 크기.<br />메모리 체크포인트 이미지 파일 및 디스크 데이터 크기와 동일하다. <br /></span></td></tr><tr><td class="confluenceTd"><span style="color: rgb(0,0,0);">ALLOC(M)</span></td><td class="confluenceTd"><span style="color: rgb(0,0,0);">테이블스페이스가 현재까지 할당 받은 페이지 중 '빈 페이지'를 제외한 '사용 중인 페이지'의 크기<br /></span></td></tr><tr><td class="confluenceTd"><span style="color: rgb(0,0,0);">USED(M)</span></td><td class="confluenceTd"><span style="color: rgb(0,0,0);">테이블스페이스가 사용 중인 페이지에서 실제 데이터가 적재된 크기.<br /></span></td></tr><tr><td class="confluenceTd"><span style="color: rgb(0,0,0);">USAGE(%)</span></td><td class="confluenceTd"><span style="color: rgb(0,0,0);">전체 메모리 테이블스페이스 : MAX 대비 TOTAL 사용률 <br />메모리 테이블스페이스 : TOTAL 대비 USED 사용률 <br />디스크 테이블스페이스 : MAX 대비 USED 사용률 </span></td></tr></tbody></table></div></li></ul><h4 id="id-8.Tablespace(TBS)-[TS07]메모리테이블스페이스데이터파일체크포인트경로">[TS07] 메모리 테이블스페이스 데이터 파일 체크포인트 경로</h4><ul style="list-style-type: square;"><li><p>아래 쿼리는 알티베이스 5 버전부터 사용할 수 있다.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;"> SELECT M.SPACE_ID TBS_ID,
       SPACE_NAME TBS_NAME,
       CHECKPOINT_PATH
  FROM V$MEM_TABLESPACES M,
       V$MEM_TABLESPACE_CHECKPOINT_PATHS C
 WHERE M.SPACE_ID = C.SPACE_ID ;</pre>
</div></div></li></ul><p> </p><h4 id="id-8.Tablespace(TBS)-[TS08]메모리테이블스페이스데이터파일">[TS08] 메모리 테이블스페이스 데이터 파일</h4><ul style="list-style-type: square;"><li><p>메모리 테이블스페이스의 stable한 데이터 파일을 보여준다. 아래 쿼리는 알티베이스 5 버전부터 사용할 수 있다.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;"> SELECT MEM_DATA_FILE DATAFILE_NAME
  FROM V$STABLE_MEM_DATAFILES ;</pre>
</div></div></li></ul><p> </p><h4 id="id-8.Tablespace(TBS)-[TS09]디스크테이블스페이스데이터파일">[TS09] 디스크 테이블스페이스 데이터 파일</h4><ul style="list-style-type: square;"><li><p>아래 쿼리는 알티베이스 5 버전부터 사용할 수 있다.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;"> SELECT B.NAME TBS_NAME,
       A.ID &#39;FILE#&#39;,
       A.NAME DATAFILE_NAME,
       CURRSIZE*8/1024 &#39;ALLOC(M)&#39;,
       ROUND(CASE2(A.MAXSIZE=0, CURRSIZE, A.MAXSIZE)*8/1024) &#39;MAX(M)&#39;,
       DECODE(AUTOEXTEND, 0, &#39;OFF&#39;, &#39;ON&#39;) &#39;AUTOEXTEND&#39;
  FROM V$DATAFILES A,
       V$TABLESPACES B
 WHERE B.ID = A.SPACEID
 ORDER BY B.NAME, A.ID
;</pre>
</div></div></li><li><p><strong>주요 컬럼 설명</strong></p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd">FILE#</td><td class="confluenceTd">데이터 파일의 번호. 하나의 디스크 테이블스페이스는 여러 개의 데이터 파일을 가질 수 있다.</td></tr></tbody></table></div></li></ul><p> </p><h4 id="id-8.Tablespace(TBS)-[TS10]디스크테이블스페이스데이터파일별I/O"><strong>[TS10] 디스크 테이블스페이스 데이터 파일 별 I/O </strong></h4><ul style="list-style-type: square;"><li><p>아래 쿼리는 알티베이스 5 버전부터 사용할 수 있다.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;"> SELECT NAME TBS_NAME,
       A.PHYRDS PHY_READ,
       A.PHYWRTS PHY_WRITE,
       A.PHYRDS+A.PHYWRTS PHY_TOTAL,
       TRUNC(A.PHYRDS/READ_SUM*100,2) &#39;READ(%)&#39;,
       TRUNC(A.PHYWRTS/WRITE_SUM*100,2) &#39;WRITE(%)&#39;,
       TRUNC( (A.PHYRDS+A.PHYWRTS) / (READ_SUM+WRITE_SUM) * 100 , 2) &#39;TOTAL(%)&#39;,
       A.AVGIOTIM AVG_IO_TIME
  FROM V$FILESTAT A,
       V$DATAFILES B,
       (SELECT SUM(PHYRDS) READ_SUM, 
               SUM(PHYWRTS) WRITE_SUM
          FROM V$FILESTAT ) C
 WHERE A.SPACEID = B.SPACEID
       AND A.FILEID = B.ID
       AND READ_SUM &gt; 0
       AND WRITE_SUM &gt; 0
 ORDER BY A.PHYRDS+A.PHYWRTS DESC, ROWNUM DESC
;</pre>
</div></div></li></ul><ul style="list-style-type: square;"><li><p><strong>주요 컬럼 설명</strong></p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd">PHY_READ</td><td class="confluenceTd">물리적 Read I/O 발생 회수</td></tr><tr><td class="confluenceTd">PHY_WRITE</td><td class="confluenceTd">물리적 Write I/O 발생 회수.</td></tr><tr><td class="confluenceTd">PHY_TOTAL</td><td class="confluenceTd">물리적 I/O 발생 회수.</td></tr><tr><td class="confluenceTd">READ(%)</td><td class="confluenceTd">전체 물리적 Read I/O 대비 발생 비율.</td></tr><tr><td class="confluenceTd">WRITE(%)</td><td class="confluenceTd">전체 물리적 Write I/O 대비 발생 비율</td></tr><tr><td class="confluenceTd">TOTAL(%)</td><td class="confluenceTd">전체 물리적 I/O 대비 발생 비율.</td></tr><tr><td class="confluenceTd">AVG_IO_TIME</td><td class="confluenceTd">평균 물리적 I/O 시간으로 단위는 밀리 초다.</td></tr></tbody></table></div></li></ul><p> </p><h4 id="id-8.Tablespace(TBS)-[TS11]디스크테이블스페이스데이터파일별단일페이지ReadI/O"><strong>[TS11] 디스크 테이블스페이스 데이터 파일 별 단일 페이지 Read I/O</strong></h4><ul style="list-style-type: square;"><li><p>아래 쿼리는 알티베이스 5 버전부터 사용할 수 있다.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;"> SELECT B.NAME TBS_NAME,
       A.SINGLEBLKRDS READ_CNT_PER_PAGE,
       A.SINGLEBLKRDTIM READ_TIME_PER_PAGE,
       TRUNC(A.SINGLEBLKRDTIM/A.SINGLEBLKRDS,2) AVERAGE_TIME
  FROM V$FILESTAT A,
       V$DATAFILES B
 WHERE A.SPACEID = B.SPACEID
       AND A.FILEID = B.ID
       AND A.SINGLEBLKRDS &gt; 0
 ORDER BY AVERAGE_TIME DESC
;</pre>
</div></div></li></ul><ul style="list-style-type: square;"><li><p><strong>주요 컬럼 설명</strong></p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd">READ_CNT_PER_PAGE</td><td class="confluenceTd">단일 페이지에 대한 Read 개수</td></tr><tr><td class="confluenceTd">READ_TIME_PER_PAGE</td><td class="confluenceTd">단일 페이지에 대한 Read 시간으로 단위는 밀리 초이다.</td></tr><tr><td class="confluenceTd">AVERAGE_TIME</td><td class="confluenceTd">단일 페이지에 대한 평균 Read 시간으로 단위는 밀리 초이다.</td></tr></tbody></table></div></li></ul><p> </p><h4 id="id-8.Tablespace(TBS)-[TS12]임시테이블스페이스사용량"><strong>[TS12] 임시 테이블스페이스 사용량</strong></h4><ul style="list-style-type: square;"><li><p>아래 쿼리는 알티베이스 6.3.1 부터 사용할 수 있다. </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;"> SELECT SUM(NORMAL_AREA_SIZE) SUM_NORMAL_AREA_SIZE
  FROM X$TEMPTABLE_STATS
 WHERE DROP_TIME = &#39;19700101_090000&#39; ;</pre>
</div></div></li></ul><ul><li><p><strong>주요 컬럼 설명</strong></p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd">NORMAL_AREA_SIZE</td><td class="confluenceTd">사용한 Temp Tablespace 공간의 크기</td></tr></tbody></table></div></li></ul><p> </p><h4 id="id-8.Tablespace(TBS)-[TS13]트랜잭션별임시테이블스페이스사용량"><strong>[TS13] 트랜잭션 별 임시 테이블스페이스 사용량 </strong></h4><ul style="list-style-type: square;"><li><p>아래 쿼리는 알티베이스 6.3.1 부터 사용할 수 있다. </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;"> SELECT NORMAL_AREA_SIZE
  FROM X$TEMPTABLE_STATS T,
       V$STATEMENT STMT
 WHERE T.TRANSACTION_ID = STMT.TX_ID ;</pre>
</div></div></li></ul><h4 id="id-8.Tablespace(TBS)-[TS14]전체테이블스페이스상태"><strong>[TS14] 전체 테이블스페이스 상태</strong></h4><ul style="list-style-type: square;"><li><p>아래 쿼리는 알티베이스 5.3.3 부터 사용할 수 있다. </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;"> SELECT NAME TBS_NAME,
       DECODE(STATE, 1, &#39;OFFLINE&#39;, 
                     2, &#39;ONLINE&#39;, 
                     5, &#39;OFFLINE BACKUP&#39;, 
                     6, &#39;ONLINE BACKUP&#39;, 
                     128, &#39;DROPPED&#39;, &#39;DISCARD&#39;) STATE
  FROM V$TABLESPACES ;</pre>
</div></div></li></ul><p> </p><p> </p>
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Jun 23, 2021 09:57</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
