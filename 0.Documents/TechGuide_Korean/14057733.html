<!DOCTYPE html>
<html>
    <head>
        <title>Technical Documents(한국어) : Altibase 운영을 위한 HPUX 설정 가이드</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Technical Documents(한국어)</a></span>
                            </li>
                                                    <li>
                                <span><a href="Home_7340036.html">Home</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Technical Documents(한국어) : Altibase 운영을 위한 HPUX 설정 가이드
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
    
            Created by <span class='author'> Technical Support 1 Team</span>, last modified on Dec 20, 2019
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p> </p><p><style type='text/css'>/*<![CDATA[*/
div.rbtoc1624409834689 {padding: 0px;}
div.rbtoc1624409834689 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1624409834689 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1624409834689'>
<ul class='toc-indentation'>
<li><a href='#Altibase운영을위한HPUX설정가이드-개요'>개요 </a></li>
<li><a href='#Altibase운영을위한HPUX설정가이드-커널파라미터'>커널 파라미터</a>
<ul class='toc-indentation'>
<li><a href='#Altibase운영을위한HPUX설정가이드-공유메모리'>공유메모리</a></li>
<li><a href='#Altibase운영을위한HPUX설정가이드-세마포어'>세마포어</a></li>
<li><a href='#Altibase운영을위한HPUX설정가이드-파일캐시'>파일캐시</a></li>
<li><a href='#Altibase운영을위한HPUX설정가이드-리소스제한'>리소스 제한</a></li>
<li><a href='#Altibase운영을위한HPUX설정가이드-변경방법'>변경 방법</a></li>
</ul>
</li>
<li><a href='#Altibase운영을위한HPUX설정가이드-사용자환경설정'>사용자 환경 설정</a>
<ul class='toc-indentation'>
<li><a href='#Altibase운영을위한HPUX설정가이드-리소스제한.2'>리소스 제한</a></li>
<li><a href='#Altibase운영을위한HPUX설정가이드-환경변수'>환경변수</a></li>
</ul>
</li>
<li><a href='#Altibase운영을위한HPUX설정가이드-멀티쓰레드관련패치'>멀티쓰레드 관련 패치</a></li>
<li><a href='#Altibase운영을위한HPUX설정가이드-요약'>요약</a></li>
</ul>
</div></p><p><span style="color: rgb(0,0,255);"><br /></span></p><p><span style="color: rgb(0,0,255);"><br /></span></p><h1 id="Altibase운영을위한HPUX설정가이드-개요">개요 </h1><hr /><p class="0cm">HPUX(Hewlett Packard Unix) 운영체제(Operating System)에서 Altibase를 설치하고 운영하기 위한 커널파라미터(kernel parameter)의 적절한 설정 값 및 각종 사용자 환경 설정에 대한 가이드를 제시한다.</p><p class="0cm">본 문서에서는 Altibase가 설치되기 전 설정해야 할 운영체제 관련사항에 대해서만 가이드를 제시하며 Altibase 자체 설정을 위한 Altibase 프로퍼티(properties) 설정에 관해서는 별도문서 『Altibase 설정파일 가이드』를 참조하도록 한다.</p><p> </p><p> </p>    <div class="aui-message warning shadowed information-macro">
                            <span class="aui-icon icon-warning">Icon</span>
                <div class="message-content">
                            <p>이 문서와 관련된 오류 및 개선사항은 기술지원포털 또는 기술지원센터로 문의주시기 바랍니다.</p><ul><li>기술지원포털 : <a href="http://support.altibase.com/" class="external-link" rel="nofollow">http://support.altibase.com</a> ▶ 기술 지식 ▶ Q&amp;A</li><li>기술지원센터 : 02-2082-1114</li></ul>
                    </div>
    </div>
    <div class="aui-message warning shadowed information-macro">
                            <span class="aui-icon icon-warning">Icon</span>
                <div class="message-content">
                            <p>이 문서는 정보 제공을 목적으로 제공되며, 사전에 예고 없이 변경될 수 있습니다. 이 문서는 오류가 있을 수 있으며, 상업적 또는 특정 목적에 부합하는 명시적, 묵시적인 책임이 일절 없습니다. 이 문서에 포함된 Altibase 제품의 특징이나 기능의 개발, 발표 등의 시기는 Altibase 재량입니다. Altibase는 이 문서에 대하여 관련된 특허권, 상표권, 저작권 또는 기타 지적 재산권을 보유할 수 있습니다.</p>
                    </div>
    </div>
<p><span style="color: rgb(0,0,255);"><br /></span></p><p><span style="color: rgb(0,0,255);"><br /></span></p><p><span style="color: rgb(0,0,255);"><br /></span></p><p><span style="color: rgb(0,0,255);"><br /></span></p><h1 id="Altibase운영을위한HPUX설정가이드-커널파라미터">커널 파라미터</h1><hr /><p class="0cm">HPUX 운영체제에서 Altibase를 운영할 경우 변경해야 할 커널파라미터의 종류와 어떤 이유로 설정을 변경해야 하는지에 대해 설명하고 커널파라미터를 변경하는 방법에 대해 소개한다.</p><p class="0cm">각 커널파라미터와 관련된 상세한 사항은 HP에서 제공하는 가이드를 참조하도록 한다.</p><p><span style="color: rgb(0,0,255);"><br /></span></p><h2 id="Altibase운영을위한HPUX설정가이드-공유메모리">공유메모리</h2><hr /><p>응용프로그램을 개발하는 경우 두 개 이상의 프로세스가 정보를 주고 받아야 할 필요성이 발생한다. 운영체제는 이를 위해 IPC (Inter Process Communication)라고 부르는 자원을 제공하고 있다. 여러 IPC 자원 중에 두 개 이상의 프로세스가 정보를 주고 받기 위해 사용되는 메모리영역을 공유메모리(shared memory)라고 부른다.</p><p>Altibase 서버와 클라이언트가 IPC 접속 방식을 사용할 경우 통신버퍼로 공유메모리를 사용하므로, 메모리를 사용하는 부분에 대한 최대크기나 세그먼트의 개수 제한 등 커널파라미터 값을 올바르게 설정해야 한다.</p><p>일반적인 유닉스 시스템에서 공유메모리와 관련된 커널파라미터 및 알티베이스 권장 값은 아래와 같다.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p align="center" style="text-align: center;">커널파라미터</p></th><th class="confluenceTh"><p style="text-align: center;">설명</p></th><th class="confluenceTh"><p style="text-align: center;">권장값</p></th></tr><tr><td class="confluenceTd"><p>shmmax</p></td><td class="confluenceTd"><p>한 개의 공유메모리 세그먼트의 최대 크기</p></td><td class="confluenceTd"><p>2GB+1</p></td></tr><tr><td class="confluenceTd"><p>shmmni</p></td><td class="confluenceTd"><p>시스템 내의 공유메모리 세그먼트의 최대 개수</p></td><td class="confluenceTd"><p>500 이상</p></td></tr><tr><td class="confluenceTd"><p>shmseg</p></td><td class="confluenceTd"><p>한 개의 프로세스에 연결된(attached) <span>공유메모리 세그먼트의 최대 개수</span></p></td><td class="confluenceTd"><p>200 이상</p></td></tr></tbody></table></div><ul><li><em>IPC_CHANNEL_COUNT</em> : Altibase 서버로 동시에 연결할 수 있는 최대 IPC 연결 개수</li></ul><p> </p><h2 id="Altibase운영을위한HPUX설정가이드-세마포어">세마포어</h2><hr /><p>공유메모리와 동일하게 IPC 자원의 일종이다. 차이점은 공유메모리가 데이터를 프로세스 간에 공유하기 위한 방법으로 제공되는 반면에 세마포어는 프로세스 간의 동기화를 구현하기 위한 방법으로 운영체제에서 제공되는 자원이다.</p><p>동기화란 특정 자원이나 객체에 대해 한 시점에 하나의 프로세스만이 접근하여 변경 가능하도록 제어 하는 것을 의미한다. (뮤텍스(mutex)와 다르게 조회는 동시에 가능하다.)</p><p>Altibase는 앞에서 설명한대로 로컬 서버 내에 Altibase 서버와 클라이언트가 함께 존재할 경우 양단간의 통신버퍼로 공유메모리를 사용하는데 이때, 메모리에 대한 동시성을 제어해야 할 필요가 있다. (동시에 쓰기를 진행하면 안되기 때문이다.)</p><p>이 경우 메모리에 대한 읽기/쓰기에 대한 접근 권한의 제어를 위해 세마포어 오퍼레이션(semaphore operation)이 발생하게 된다.</p><p>세마포어 오퍼레이션에 따라 프로세스는 대기상태가 되거나 혹은 진행상태가 될 수 있다. 이러한 세마포어 오퍼레이션은 동시다발적으로 발생되기 때문에 세마포어의 개수 및 오퍼레이션에 대한 적합한 커널파라미터 설정이 필요하다.</p><p>일반적인 유닉스 시스템에서 세마포어와 관련된 커널파라미터는 아래와 같다.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p style="text-align: center;">커널파라미터</p></th><th class="confluenceTh"><p style="text-align: center;">설명</p></th><th class="confluenceTh"><p>권장값</p></th></tr><tr><td colspan="1" class="confluenceTd"><span>semmni</span></td><td colspan="1" class="confluenceTd"><span>시스템 내 세마포어 세트의 최대 개수로, 하나의 세트당 84바이트의 커널메모리가 할당된다.</span></td><td colspan="1" class="confluenceTd">5029</td></tr><tr><td class="confluenceTd"><p>semmns</p></td><td class="confluenceTd"><p>시스템 내 세마포어의 최대 개수로, 16바이트의 커널메모리가 할당된다.</p></td><td class="confluenceTd"><p>8192</p></td></tr><tr><td class="confluenceTd"><p>semmsl</p></td><td class="confluenceTd"><p>한 개의 세마포어 세트에 존재하는 세마포어의 최대 개수이며 논리적으로 semmns보다 같거나 작아야 한다.</p><p>너무 크게 잡으면 몇 개의 세마포어 ID가 시스템 전체의 세마포어를 독점할 수 있다.</p></td><td class="confluenceTd"><p>2000</p></td></tr><tr><td class="confluenceTd"><p>semmnu</p></td><td class="confluenceTd"><p>시스템 내의 undo structure의 최대 개수</p></td><td class="confluenceTd"><p>1024</p></td></tr><tr><td class="confluenceTd"><p>semume</p></td><td class="confluenceTd"><p>한 개의 프로세스 당 undo entry의 최대 개수</p></td><td class="confluenceTd"><p>512</p></td></tr><tr><td class="confluenceTd"><p>semvmx</p></td><td class="confluenceTd"><p>한 개의 세마포어의 최대값</p></td><td class="confluenceTd"><p>32767</p></td></tr></tbody></table></div><ul><li><em>IPC_CHANNEL_COUNT</em> : Altibase 서버로 동시에 연결할 수 있는 최대 IPC 연결 개수</li></ul><p><span style="color: rgb(0,0,255);"><br /></span></p><h2 id="Altibase운영을위한HPUX설정가이드-파일캐시">파일캐시</h2><hr /><p>본 커널파라미터는 변경이 필수적인 요소는 아니나, 적절한 파일캐시(file cache) 설정으로 Altibase가 사용하는 메모리 영역에 대한 스왑아웃(swap out) 발생요건을 억제, 스왑핑(swapping)으로 인한 운영체제 계층의 Disk I/O 지연시간이 Altibase의 성능저하로 이어지는 현상을 최소화하기 위해 권고하는 사항이다.</p><p>파일캐시란 주기억장치와 보조기억장치 간의 속도차이로 인한 병목을 해소하기 위해 운영체제 차원에서 관리되는 일종의 시스템버퍼이다. 이러한 파일캐시는 운영체제 저마다의 고유한 정책(policy)에 의하여 관리되나 공통적으로 스왑정책과 직접적인 상관관계를 가진다.</p><p>스왑핑 자체는 주기억장치보다 더 큰 응용프로그램이나 데이터 파일을 다룰 수 있게 하는 유용함을 가지고 있으나, DBMS와 같이 장기상주 형의 응용프로그램이 운영되는 시스템에서는 스왑핑으로 인한 운영체제 계층의 Disk I/O 지연시간으로 DBMS의 응답시간이 불규칙해지거나 지연되는 현상이 발생될 수 있기에 파일캐시가 시스템 용도에 따라 고려 요소가 된다.</p><p>따라서, Altibase의 일관적인 응답시간 보장을 위해서는 스왑이 최대한 발생하지 않도록 파일캐시 및 스왑 관련 커널파라미터들을 사전에 설정하는 것을 권장한다.</p><h3 id="Altibase운영을위한HPUX설정가이드-HPUX에서의설정"><strong>HPUX<span style="color: rgb(0,0,0);">에서의 설정</span></strong></h3><p>아래 커널파라미터를 통해 파일캐시를 조정하는 것을 권장한다.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p style="text-align: center;">커널파라미터</p></th><th class="confluenceTh"><p style="text-align: center;">설명</p></th><th class="confluenceTh"><p style="text-align: center;">권장값</p></th></tr><tr><td class="confluenceTd"><p>dbc_min_pct</p></td><td class="confluenceTd"><p>파일캐시의 최소 크기를 전체 메모리 대비 백분율로 제한. 기본값은 5%로 HPUX 11.31부터는 filecache_min 로 명칭이 변경됨.</p></td><td class="confluenceTd"><p>5%</p></td></tr><tr><td class="confluenceTd"><p>dbc_max_pct</p></td><td class="confluenceTd"><p>파일캐시의 최대 크기를 전체 메모리 대비 백분율로 제한. 기본값은 50%로 HPUX 11.31부터는 filecache_max 로 명칭이 변경됨.</p></td><td class="confluenceTd"><p>5~20%</p></td></tr></tbody></table></div><p>참고로 dbc_max_pct에 대한 HP에서의 권고안은 물리메모리 크기가 8 GB 이하 시스템에서는 20%, 8 GB 이상 시스템에서는 10%를 권고하므로 이를 참고하도록 한다.</p><p><span style="color: rgb(0,0,255);"><br /></span></p><h2 id="Altibase운영을위한HPUX설정가이드-리소스제한">리소스 제한</h2><hr /><p>HPUX 경우, 리소스 제한 항목 중 일부는 일반적으로 흔히 사용하는 ulimit을 사용한 사용자 환경설정파일 설정이 아닌 아래와 같은 커널파라미터 변경을 통하여 설정한다.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p style="text-align: center;">커널파라미터</p></th><th class="confluenceTh"><p style="text-align: center;">설명</p></th><th class="confluenceTh"><p style="text-align: center;">권장값</p></th></tr><tr><td class="confluenceTd"><p>maxdsiz</p></td><td class="confluenceTd"><p>하나의 32bit 프로세스가 할당 가능한 데이터 세그먼트 합계</p></td><td class="confluenceTd"><p>2 GB</p></td></tr><tr><td class="confluenceTd"><p>maxdsiz_64bit</p></td><td class="confluenceTd"><p>하나의 64bit 프로세스가 할당 가능한 데이터 세그먼트 합계</p></td><td class="confluenceTd"><p>1 TB</p><p>최대 4 TB</p><p>예측되는 Altibase 프로세스 <span>최대 </span>크기를 고려하여 설정</p></td></tr><tr><td class="confluenceTd"><p>max_thread_proc</p></td><td class="confluenceTd"><p>하나의 프로세스가 가질 수 있는 쓰레드 최대 개수</p></td><td class="confluenceTd"><p>600 이상</p></td></tr><tr><td class="confluenceTd"><p>maxfiles</p></td><td class="confluenceTd"><p>하나의 프로세스가 동시에 오픈(open)할 수 있는 최대 파일 개수(soft-limit)</p><p>maxfiles_lim(hard-limit)까지 늘릴 수 있음.</p></td><td class="confluenceTd"><p>2048 이상</p></td></tr><tr><td class="confluenceTd"><p>nproc</p></td><td class="confluenceTd"><p>시스템 내의 최대 프로세스 개수</p></td><td class="confluenceTd"><p>6142</p></td></tr><tr><td class="confluenceTd"><p>maxusers</p></td><td class="confluenceTd"><p>nproc, ncallout, ninode, nfile의 기본값의 근간</p></td><td class="confluenceTd"><p>124</p><p>11.23 미만에서만 해당</p></td></tr></tbody></table></div><p>“maxusers”의 경우, HPUX 11.23부터는 사라졌으므로 HPUX 11.23 이상에서는 고려하지 않아도 된다. HPUX 11.23 미만에서는 “nproc” 를 직접 설정하지 않고 “maxusers”를 124로 설정하는 것으로 대체한다.</p><p><span style="color: rgb(0,0,255);"><br /></span></p><h2 class="title" id="Altibase운영을위한HPUX설정가이드-변경방법">변경 방법</h2><hr /><p>HPUX 경우, 커널파라미터 수정을 위해서 Tunable 커널파라미터 유틸리티(HPUX 11.11에서는 kmtune, HPUX 11.23부터는 kctune을 주로 사용) 또는 시스템의 모든 커널파라미터를 변경할 수 있는 sam이라는 유틸리티를 주로 사용한다. 여기서는 kctune을 사용한 예를 다룬다.</p><p>기본적으로 root 계정으로 접속이 필요하며 실시간으로 적용되는 커널파라미터라 할지라도 올바르게 적용하기 위해서 변경 후 시스템을 재 구동을 하는 것을 권장한다.</p><h3 id="Altibase운영을위한HPUX설정가이드-공유메모리.1">공유메모리</h3><p>이전에 별도의 설정이 없었다면 공유메모리 관련 커널파라미터 변경으로 shmmni, shmseg만 변경해도 무방하다.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>공유메모리 변경 예제</b></div><div class="codeContent panelContent pdl">
<pre class="theme: Emacs; brush: bash; gutter: false" style="font-size:12px;">$ kctune shmmni=500
$ kctune shmseg=200</pre>
</div></div><h3 id="Altibase운영을위한HPUX설정가이드-세마포어.1">세마포어</h3><p>이전에 별도의 설정이 없었다면 세마포어 관련 커널파라미터 변경으로 semmns, semmni, semmnu, semume 만 변경해도 무방하다.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>세마포어 변경 예제</b></div><div class="codeContent panelContent pdl">
<pre class="theme: Emacs; brush: bash; gutter: false" style="font-size:12px;">$ kctune semmns=8192
$ kctune semmni=5029
$ kctune semmnu=1024
$ kctune semume=512</pre>
</div></div><h3 id="Altibase운영을위한HPUX설정가이드-파일캐시.1">파일캐시</h3><p>dbc_max_pct의 경우, HP의 권고치의 따라 물리메모리 8GB 이하 시스템에서는 20%, 8GB 이상 시스템에서는 10%를 권고한다.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>파일캐시 변경 예제</b></div><div class="codeContent panelContent pdl">
<pre class="theme: Emacs; brush: bash; gutter: false" style="font-size:12px;">$ kctune dbc_min_pct=5
$ kctune dbc_max_pct=10
또는
$ kctune filecache_min=5%

$ kctune filecache_max=10%
</pre>
</div></div><h3 id="Altibase운영을위한HPUX설정가이드-리소스제한.1">리소스 제한</h3><p>위에서 언급한 리소스 제한 관련 커널파라미터를 변경하는 방법은 아래와 같다.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>리소스 제한 변경 예제</b></div><div class="codeContent panelContent pdl">
<pre class="theme: Emacs; brush: bash; gutter: false" style="font-size:12px;">$ kctune maxdsiz=2147483648
$ kctune maxdsiz_64bit=4396972765184
$ kctune max_thread_proc=600
$ kctune maxfiles=2048
$ kctune nproc=6142</pre>
</div></div><p>HPUX 11.23 미만에서는 “nproc” 를 직접적으로 설정하지 않고 “maxusers”를 124로 설정하는 것으로 대체한다.</p><p><span style="color: rgb(0,0,255);"><br /></span></p><p><span style="color: rgb(0,0,255);"><br /></span></p><p><span style="color: rgb(0,0,255);"><br /></span></p><h1 id="Altibase운영을위한HPUX설정가이드-사용자환경설정">사용자 환경 설정</h1><hr /><p class="0cm">HPUX 운영체제에서 Altibase 운영을 위한 시스템 내의 사용자 계정의 리소스 제한, 환경변수 및 각종 환경 설정에 대해 설명한다.</p><p class="0cm">설정과 관련된 명령어 및 구체적인 사항은 HP에서 제공하는 가이드를 참조하도록 한다.</p><p class="0cm"><span style="color: rgb(0,0,255);"><br /></span></p><h2 id="Altibase운영을위한HPUX설정가이드-리소스제한.2">리소스 제한</h2><hr /><p>유닉스 운영체제에서는 사용자 계정 단위로 사용 가능한 리소스에 대한 논리적인 제한 값을 설정한다. 이 리소스 제한 항목 중, 안정적인 서비스 운영을 위해 확장시켜야 하는 일반적인 항목들은 아래와 같다.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p style="text-align: center;">항목</p></th><th class="confluenceTh"><p style="text-align: center;">설명</p></th><th class="confluenceTh"><p style="text-align: center;">권장값</p></th></tr><tr><td class="confluenceTd"><p>data seg size(data)</p></td><td class="confluenceTd"><p>하나의 프로세스 데이터영역의 최대크기</p></td><td class="confluenceTd"><p>unlimited</p></td></tr><tr><td class="confluenceTd"><p>file size (fsize)</p></td><td class="confluenceTd"><p>생성될 수 있는 파일의 최대크기</p></td><td class="confluenceTd"><p>unlimited</p></td></tr><tr><td class="confluenceTd"><p>open files (nofiles)</p></td><td class="confluenceTd"><p>하나의 프로세스가 동시에 접근 가능한 파일의 최대개수</p></td><td class="confluenceTd"><p>unlimited</p></td></tr><tr><td class="confluenceTd"><p>max memory size (rss)</p></td><td class="confluenceTd"><p>사용 가능한 메모리의 최대크기</p></td><td class="confluenceTd"><p>unlimited</p></td></tr><tr><td class="confluenceTd"><p>virtual memory (memory)</p></td><td class="confluenceTd"><p>사용 가능한 가상메모리의 최대크기</p></td><td class="confluenceTd"><p>unlimited</p></td></tr><tr><td class="confluenceTd"><p>max user process</p></td><td class="confluenceTd"><p>사용자 당 생성 가능한 프로세스의 개수</p></td><td class="confluenceTd"><p>unlimited</p></td></tr></tbody></table></div><p>리소스 제한 변경은 특정 사용자가 사용하는 메모리 및 데이터파일 영역 확장 시 물리적인 리소스가 풍부한데도 논리적인 제한으로 인해 발생할 수 있는 문제를 사전에 제거하기 위한 것이므로 해당 운영체제에서 허용하는 최대값(가능하면 unlimited)으로 설정하는 것을 권고한다.</p><p>예를 들어, open files의 의미는 프로세스가 접근하는 파일 뿐만 아니라 통신 소켓의 개수까지 포함하고 있으므로 최대 동시 접속 클라이언트 수, 동시에 사용하는 데이터파일 수, 리두로그 파일 수 및 트레이스 로그파일 수까지 고려되어야 한다.</p><p>변경방법은 ulimit 명령을 사용한 환경설정파일 편집 및 시스템 리소스 설정파일 편집 또는 해당 운영체제 별로 제공하는 커널 관련 유틸리티 활용이 있다.</p><h3 id="Altibase운영을위한HPUX설정가이드-Hard-Limit&amp;Soft-Limit"><strong>Hard-Limit &amp; Soft-Limit</strong></h3><p>리소스 제한 값은 hard-limit, soft-limit 이라는 개념으로 구분된다.</p><p>hard-limit은 root 계정 외에는 변경할 수 없는 커널 차원의 리소스 제한 최대값을 의미하며 soft-limit은 현재 사용자 계정 내에서 hard-limit까지 변경이 가능하다는 것을 의미한다. (상세한 내용은 ulimit –S / -H 옵션을 참고한다.)</p><p>soft-limit은 사용자가 접속을 하여 세션을 유지하는 동안 유효하며 변경을 하면 즉시 반영된다. 하지만 동일 사용자 계정의 다른 세션이 연결되면 기존의 soft-limit이 반영되기 때문에 ulimit 명령어를 사용자 계정의 환경설정파일에 추가하는 것을 권장한다.</p><p>하지만, 이러한 방법은 전역적인 hard-limit에 의해 의도한 설정이 되지 않을 수 있으므로 환경설정파일을 이용한 사용자 계정 단위 적용보다는 시스템 차원의 리소스 설정파일 편집을 통하여 체계적으로 적용하는 것을 권고한다.</p><p>단, HPUX는 시스템 차원의 리소스 설정파일이 없으므로 리소스 제한을 위한 hard-limit 변경 시 sam이나 kctune을 사용한다.</p><p><span style="color: rgb(0,0,255);"><br /></span></p><h2 id="Altibase운영을위한HPUX설정가이드-환경변수">환경변수</h2><hr /><p>필수로 설정해야 하는 환경변수는 아래와 같다. 아래 환경변수를 설정하고자 하는 사용자의 쉘(shell) 문법(syntax)에 따라 사용자 계정의 환경설정파일에 설정한다.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p style="text-align: center;">환경변수</p></th><th class="confluenceTh"><p style="text-align: center;">설명</p></th></tr><tr><td class="confluenceTd"><p>ALTIBASE_HOME</p></td><td class="confluenceTd"><p>Altibase를 설치한 경로를 지정한다.</p></td></tr><tr><td class="confluenceTd"><p>PATH</p></td><td class="confluenceTd"><p>ALTIBASE_HOME/bin을 추가한다. 이 경로에 있는 바이너리 및 쉘 스크립트를 경로에 상관없이 실행하기 위한 설정이다.</p></td></tr><tr><td class="confluenceTd"><p>LD_LIBRARY_PATH</p></td><td class="confluenceTd"><p><span>ALTIBASE</span><span>_HOME/lib을 추가한다. </span>Altibase의 동적 라이브러리를 사용하기 위한 설정이다.</p></td></tr></tbody></table></div><p>이와 더불어 HPUX에만 존재하는 아래 환경변수도 필수적으로 추가하여야 한다.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p style="text-align: center;">환경변수</p></th><th class="confluenceTh"><p style="text-align: center;">설명</p></th></tr><tr><td class="confluenceTd"><p>SHLIB_PATH</p></td><td class="confluenceTd"><p><span>ALTIBASE</span><span>_HOME/lib을 추가한다. </span>동적 라이브러리를 32비트로 링크할 경우 설정한다.</p></td></tr></tbody></table></div><h3 id="Altibase운영을위한HPUX설정가이드-멀티쓰레드응용프로그램을위한설정(1)">멀티쓰레드 응용프로그램을 위한 설정(1)</h3><p>멀티쓰레드(multi-thread) 기반의 응용프로그램인 Altibase를 위해 별도 환경변수 설정이 필요하다. 참고로 본 문서에서는 대표적인 것만 언급하고, HPUX에서 지원하는 멀티쓰레드 관련 환경변수는 모두 고려할 필요가 있음을 유의해야 한다.</p><p>아래 요소는 모두 필수적인 사항이다. 그 중에서도 MxN 쓰레드모델 관련 환경변수인 PTHREAD_FORCE_SCOPE_SYSTEM는 반드시 설정하도록 한다.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p style="text-align: center;">환경변수</p></th><th class="confluenceTh"><p style="text-align: center;">설명</p></th><th class="confluenceTh"><p style="text-align: center;">비고</p></th></tr><tr><td class="confluenceTd"><p>PTHREAD_FORCE_SCOPE_SYSTEM</p></td><td class="confluenceTd"><p>쓰레드 경합(contention) 영역을 시스템으로 설정</p></td><td class="confluenceTd"><p>HPUX 11.23부터 지원</p></td></tr><tr><td class="confluenceTd"><p>PERF_ENABLE</p></td><td class="confluenceTd"><p>유저 영역 sleep queue 연산 일부를 생략</p></td><td class="confluenceTd"><p>HPUX 11.23만 지원</p></td></tr><tr><td class="confluenceTd"><p>PTHREAD_FAST_SHARED_OBJECTS</p></td><td class="confluenceTd"><p>Shared Object에 대한 Private 알고리즘 적용</p></td><td class="confluenceTd"><p>HPUX 11.31부터 지원</p></td></tr><tr><td class="confluenceTd"><p>PTHREAD_DISABLE_HANDOFF</p></td><td class="confluenceTd"><p>다중 CPU 환경에서 적용</p></td><td class="confluenceTd"><p>HPUX 11.23부터 지원</p></td></tr></tbody></table></div><p>PERF_ENABLE의 경우, HPUX 11.31부터는 PTHREAD_FORCE_SCOPE_SYSTEM에 포함되므로 HPUX 11.31이상에서는 고려하지 않아도 된다. </p><h3 id="Altibase운영을위한HPUX설정가이드-멀티쓰레드응용프로그램을위한설정(2)"><strong>멀티쓰레드 응용프로그램을 위한 설정(2)</strong></h3><p>이 역시 멀티쓰레드 기반의 응용프로그램을 위한 설정으로 정해진 권장 값을 제시할 수 없는 튜닝적인 요소이나 초기에 고려되어야 하는 사항이기에 언급한다.</p><p>특정 프로세스에 대한 메모리 요구를 위해 하나의 메모리할당영역만 사용하는 운영체제에서는 멀티쓰레드 응용프로그램의 여러 쓰레드가 동시에 메모리 요청(malloc, free)을 하였을 때 잠금 연산으로 인한 경합이 발생하므로 성능저하가 발생한다.</p><p>이러한 문제를 개선하기 위해 HPUX는 아레나(arena)라 불리는 메모리할당영역을 프로세스당 최대 64개까지 제공, 아레나 간에 쓰레드를 분산하여 메모리 요청으로 인해 발생하는 잠금 경합을 감소시킬 수 있다.</p><p>아래 환경변수로 설정이 가능하다.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p style="text-align: center;">환경변수</p></th><th class="confluenceTh"><p style="text-align: center;">설명</p></th><th class="confluenceTh"><p style="text-align: center;">비고</p></th></tr><tr><td class="confluenceTd"><p>_M_ARENA_OPTS=x:y</p></td><td class="confluenceTd"><p>x: 프로세스 당 할당될 아레나 개수로</p><p> 기본값은 8이다. [범위: 1-64]</p><p> </p><p>y: 아레나의 확장 단위로</p><p>메모리 페이지 개수로 나타내며</p><p>기본값은 32이다. [범위: 1-4096]</p></td><td class="confluenceTd"><p>아레나 개수(x)가 클수록 시스템 메모리 사용량이 늘어나고 작을수록 Altibase의 성능이 저하되므로 적절한 수치로 설정 필요.</p></td></tr></tbody></table></div><p>기본적으로 멀티쓰레드 응용프로그램이 아닌 경우는 설정여부와 관계없이 한 개의 아레나로 작동하며 유효하지 않은 값으로 설정할 경우, 기본값으로 동작한다.</p><p>예를 들어, 다음과 같이 설정한다면 멀티쓰레드 응용프로그램에 한하여 24개의 아레나를 할당하고 각 아레나는 확장 시 64*4KB(일반적인 메모리 페이지 크기) 단위로 증가하게 되는 것이다.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>_M_ARENA_OPTS 설정 예제</b></div><div class="codeContent panelContent pdl">
<pre class="theme: Emacs; brush: bash; gutter: false" style="font-size:12px;">$ export _M_ARENA_OPTS = 24:64</pre>
</div></div><p>일반적으로 응용프로그램의 쓰레드 수가 많을수록 더 많은 수의 아레나를 사용해야 성능이 향상된다. 하지만, 그렇다고 해서 너무 크게 설정하면 힙(heap)영역의 단편화(fragmentation)가 발생, 비효율적인 메모리 사용으로 인해 프로세스의 사이즈가 지나치게 커져서 시스템 메모리 부족 현상이 발생할 수 있으므로 설정 시 면밀한 검토가 요구되는 사항이다.</p><p>예를 들어, 시스템의 물리 메모리 자체가 적어 메모리 부족 현상이 우려된다면 경우에 따라 단일쓰레드 응용프로그램처럼 동작하도록 1:8로 설정하기도 하며 성능저하 발생시 성능저하 원인이 메모리 요청(malloc/free)과 관련된 병목이라면 리소스 범위 내에서 값을 늘리는 것이 일반적이다. </p><p><span style="color: rgb(0,0,255);"><br /></span></p><p><span style="color: rgb(0,0,255);"><br /></span></p><p><span style="color: rgb(0,0,255);"><br /></span></p><h1 id="Altibase운영을위한HPUX설정가이드-멀티쓰레드관련패치">멀티쓰레드 관련 패치</h1><hr /><p>Altibase는 단일 프로세스, 멀티쓰레드 기반의 응용프로그램이다. 따라서, 멀티쓰레드 관련 HPUX 패치(patch)가 필요하다. 이 중에서도 “pthread library cumulative patch”는 성능에 직접적인 영향을 끼치는 것으로 반드시 패치 유무가 확인되어야 한다.</p><p>현재 시스템의 패치리스트를 확인하는 방법은 아래와 같다.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>멀티쓰레드 관련 패치 확인 방법</b></div><div class="codeContent panelContent pdl">
<pre class="theme: Emacs; brush: bash; gutter: false" style="font-size:12px;">$ swlist -l patch | grep pthread
$ PHCO_38955    1.0          pthread library cumulative patch 
$ PHKL_35709    1.0          pthread_cond_timedwait,hires timers,callout 
$ PHKL_37122    1.0          pthread_condvar_prio_boost patch</pre>
</div></div><p>이 외에도 HPUX 에서 알려진 각종 문제를 피하기 위해 최신 패치 적용을 권고한다. </p><h3 id="Altibase운영을위한HPUX설정가이드-PHCO_33675및PHCO_34718을적용한경우추가고려사항"><strong>PHCO_33675</strong> 및 <strong>PHCO_34718</strong>을 적용한 경우 추가 고려사항</h3><p>HPUX 11.23에서 해당 패치를 적용한 경우, 응용 프로그램에서 공유 뮤텍스(mutex)를 더 오랫동안 보관하여 성능이 저하되는 현상이 HP를 통하여 보고되었다.</p><p>패치리스트를 확인하여 해당 패치가 존재한다면 다음과 같은 환경변수를 추가, 1로 설정하여 시스템 성능을 복원하여야 한다.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p style="text-align: center;">환경변수</p></th><th class="confluenceTh"><p style="text-align: center;">설명</p></th><th class="confluenceTh"><p style="text-align: center;">비고</p></th></tr><tr><td class="confluenceTd"><p>PTHREAD_SHARED_MUTEX_OLDSPIN</p></td><td class="confluenceTd"><p>PHCO_33675, PHCO_34718 로 인한 성능저하 원복</p></td><td class="confluenceTd"><p>HPUX 11.23에서만 고려</p></td></tr></tbody></table></div><p><span style="color: rgb(0,0,255);"><br /></span></p><p><span style="color: rgb(0,0,255);"><br /></span></p><p><span style="color: rgb(0,0,255);"><br /></span></p><h1 id="Altibase운영을위한HPUX설정가이드-요약">요약</h1><hr /><p class="0cm">HPUX 운영체제에서 Altibase의 안정적인 운영을 위해서는 사전에 커널파라미터 설정 및 사용자 환경 설정을 수행해야 한다. 설정을 올바르게 수행하지 않은 경우, 시스템의 리소스가 충분함에도 불구하고 각각의 제한 값들에 의해 문제가 발생 할 수 있으므로 주의해야 한다.</p><p><span style="color: rgb(0,0,255);"><br /></span></p><h3 id="Altibase운영을위한HPUX설정가이드-커널파라미터.1">커널파라미터</h3><p>아래 표를 참조하여 커널파라미터를 적절하게 설정하도록 한다. 참고로 HPUX에서는 리소스 제한 항목 중 일부를 커널파라미터를 변경으로 조절한다.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p style="text-align: center;">분류</p></th><th class="confluenceTh"><p style="text-align: center;">커널파라미터</p></th><th class="confluenceTh"><p style="text-align: center;">권장값</p></th><th class="confluenceTh"><p style="text-align: center;">비고</p></th></tr><tr><td rowspan="2" class="confluenceTd"><p>공유메모리</p></td><td class="confluenceTd"><p>shmmni</p></td><td class="confluenceTd"><p>500 이상</p></td><td class="confluenceTd"><p>&gt; shmseg</p></td></tr><tr><td class="confluenceTd"><p>shmseg</p></td><td class="confluenceTd"><p>200 이상</p></td><td class="confluenceTd"><p> </p></td></tr><tr><td rowspan="4" class="confluenceTd"><p>세마포어</p></td><td class="confluenceTd"><p>semmns</p></td><td class="confluenceTd"><p>8192</p></td><td class="confluenceTd"><p> </p></td></tr><tr><td class="confluenceTd"><p>semmni</p></td><td class="confluenceTd"><p>5029</p></td><td class="confluenceTd"><p> </p></td></tr><tr><td class="confluenceTd"><p>semmnu</p></td><td class="confluenceTd"><p>5029</p></td><td class="confluenceTd"><p>semmni</p></td></tr><tr><td class="confluenceTd"><p>semume</p></td><td class="confluenceTd"><p>5029</p></td><td class="confluenceTd"><p>semmni</p></td></tr><tr><td rowspan="2" class="confluenceTd"><p>파일캐시</p></td><td class="confluenceTd"><p>dbc_min_pct</p></td><td class="confluenceTd"><p>5 이하</p></td><td class="confluenceTd"><p> </p></td></tr><tr><td class="confluenceTd"><p>dbc_max_pct</p></td><td class="confluenceTd"><p>20 이하</p></td><td class="confluenceTd"><p>물리메모리 8GB 이하 시스템에서는 20% 권장, 8GB 이상 시스템에서는 10% 권장</p></td></tr><tr><td rowspan="6" class="confluenceTd"><p>리소스 제한</p></td><td class="confluenceTd"><p>maxdsiz</p></td><td class="confluenceTd"><p>2GB</p></td><td class="confluenceTd"><p>data seg size에 대응 (32bit)</p></td></tr><tr><td class="confluenceTd"><p>maxdsiz_64bit</p></td><td class="confluenceTd"><p>1TB / 최대 약 4TB</p></td><td class="confluenceTd"><p>data seg size에 대응 (64bit)</p></td></tr><tr><td class="confluenceTd"><p>maxfiles</p></td><td class="confluenceTd"><p>5029 이상</p></td><td class="confluenceTd"><p>open files에 대응</p></td></tr><tr><td class="confluenceTd"><p>max_thread_proc</p></td><td class="confluenceTd"><p>5029 이상</p></td><td class="confluenceTd"><p> </p></td></tr><tr><td class="confluenceTd"><p>nproc</p></td><td class="confluenceTd"><p>6142</p></td><td class="confluenceTd"><p>max user process 에 대응</p><p>&gt;= semmnu + 4</p></td></tr><tr><td class="confluenceTd"><p>maxusers</p></td><td class="confluenceTd"><p>124</p></td><td class="confluenceTd"><p>HPUX 11.23부터 사라짐</p></td></tr></tbody></table></div><p> </p><h3 id="Altibase운영을위한HPUX설정가이드-사용자리소스제한">사용자 리소스 제한</h3><p>아래 표를 참조하여 가능한 모두 무제한으로 설정한다.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p style="text-align: center;">항목</p></th><th class="confluenceTh"><p style="text-align: center;">설명</p></th><th class="confluenceTh"><p style="text-align: center;">권장값</p></th></tr><tr><td class="confluenceTd"><p>data seg size(data)</p></td><td class="confluenceTd"><p>프로세스 데이터영역의 최대크기</p></td><td class="confluenceTd"><p>maxdsiz</p><p>maxdsiz_64bit</p><p>unlimited</p></td></tr><tr><td class="confluenceTd"><p>file size (fsize)</p></td><td class="confluenceTd"><p>생성되는 파일의 최대크기</p></td><td class="confluenceTd"><p>unlimited</p></td></tr><tr><td class="confluenceTd"><p>open files (nofiles)</p></td><td class="confluenceTd"><p>하나의 프로세스가 동시에 접근 가능한 파일의 최대개수</p></td><td class="confluenceTd"><p>maxfiles</p><p><span>unlimited</span></p></td></tr><tr><td class="confluenceTd"><p>max memory size (rss)</p></td><td class="confluenceTd"><p>사용 가능한 메모리의 최대크기</p></td><td class="confluenceTd"><p>unlimited</p></td></tr><tr><td class="confluenceTd"><p>max user process</p></td><td class="confluenceTd"><p>사용자당 생성 가능한 프로세스의 개수</p></td><td class="confluenceTd"><p>nproc</p><p><span>unlimited</span></p></td></tr></tbody></table></div><h3 id="Altibase운영을위한HPUX설정가이드-사용자환경변수">사용자 환경변수</h3><p>sh, bash, ksh의 경우, 환경설정파일을 이용한 필수 환경변수 설정예제는 아래와 같다. csh의 경우는 export 대신 setenv 와 같은 쉘 명령어를 통해 설정한다.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>사용자 환경변수 설정 예제</b></div><div class="codeContent panelContent pdl">
<pre class="theme: Emacs; brush: bash; gutter: false" style="font-size:12px;"># For Multi-Threaded Applications
PTHREAD_FORCE_SCOPE_SYSTEM=ON; export PTHREAD_FORCE_SCOPE_SYSTEM;
PTHREAD_FAST_SHARED_OBJECTS=ON; export PTHREAD_FAST_SHARED_OBJECTS;
PTHREAD_DISABLE_HANDOFF=ON; export PTHREAD_DISABLE_HANDOFF;
PERF_ENABLE=1; export PERF_ENABLE;
_M_ARENA_OPTS=8:32; export _M_ARENA_OPTS;

# For Altibase
ALTIBASE_HOME=/ALTIBASE; export ALTIBASE_HOME;
PATH=$ALTIBASE_HOME/bin:$PATH; export PATH;
ALTIBASE_NLS_USE=MS949; export ALTIBASE_NLS_USE;
SHLIB_PATH=$ALTIBASE_HOME/lib:$SHLIB_PATH; export SHLIB_PATH; # For 32bit
LD_LIBRARY_PATH=$ALTIBASE_HOME/lib:$LD_LIBRARY_PATH; export LD_LIBRARY_PATH; # For 64bit

# For Resource Limitation
ulimit –f unlimited  # file size, fsize
ulimit -m unlimited  # max memory size, rss</pre>
</div></div><p>참고로 ksh의 경우, 환경변수가 미리 정의되지 않은 상태에서 환경변수를 사용하여 또 다른 환경변수를 정의 시 오류가 발생할 수 있다.</p><p>위 예제에서 “_M_ARENA_OPTS”는 단순히 기본값을 명시한 것으로, 시스템에 따라 적절하게 고려하여 설정해야 한다. 상세한 내용은 [환경변수] 섹션의 “멀티쓰레드 응용프로그램을 위한 설정(2)”를 참조하도록 한다.</p><p>이와 더불어, [멀티쓰레드 관련 패치] 섹션의 “PHCO_33675 및 PHCO_34718을 적용한 경우 추가 고려사항”도 참고한다.</p><p> </p>
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Jun 23, 2021 09:57</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
