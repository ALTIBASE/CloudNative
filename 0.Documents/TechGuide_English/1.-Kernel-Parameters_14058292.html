<!DOCTYPE html>
<html>
    <head>
        <title>Technical Documents(English) : 1. Kernel Parameters</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Technical Documents(English)</a></span>
                            </li>
                                                    <li>
                                <span><a href="Home_557064.html">Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="Solaris-Setup-Guide-for-Altibase_14058290.html">Solaris Setup Guide for Altibase</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Technical Documents(English) : 1. Kernel Parameters
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
    
            Created by <span class='author'> richard.nahm	</span>, last modified by <span class='editor'> david.cho</span> on Dec 22, 2020
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <h2 class="md-end-block md-heading" id="id-1.KernelParameters-KernelParameters"><span class="md-plain">Kernel Parameters</span></h2><p class="md-end-block md-p"><span class="md-plain">This section describes the types of kernel parameters that need to be changed when operating Altibase on the Solaris OS, and explains why the settings need to be changed. </span>The last part introduces how to change kernel parameters in Solaris.</p><p class="md-end-block md-p">Refer to the guide provided by Solaris for details regarding each kernel parameter.</p><h3 class="md-end-block md-heading" id="id-1.KernelParameters-SharedMemory"><span class="md-plain">Shared Memory</span></h3><p class="md-end-block md-p"><span class="md-plain">When developing an application, two or more processes need to exchange information. The operating system provides a resource called IPC (Inter Process Communication). Among various IPC resources, the memory area used by two or more processes to exchange information is called shared memory.</span></p><p class="md-end-block md-p"><span class="md-plain">The shared memory can be set by dividing it into one or more areas by designating a unit. One shared memory area is called a segment.</span></p><p class="md-end-block md-p"><span class="md-plain">For example, a user may set a shared memory having one segment at 10 megabytes, or a 100 megabyte shared memory by configuring a 10 megabyte area as 10 segments.</span></p><p class="md-end-block md-p"><span class="md-plain">Altibase loads memory DB in the heap area of the process by default, but it can be loaded and used in shared memory depending on the user's settings. (Refer to the &quot;</span><span><em><span class="md-plain">Altibase Property Setting Guide</span></em><span class="md-plain">&quot; document for the setting method related to this.) Alternatively, the communication buffer of the client accessing the DBMS can be set to be exchanged through the shared memory. Therefore, it is necessary to change the kernel parameter settings for the maximum size of the part that uses memory or the number of segments.</span></span></p><p class="md-end-block md-p"><span class="md-plain">The kernel parameters related to shared memory in a typical Unix system are as follows.</span></p><div class="table-wrap"><table class="confluenceTable"><thead><tr><th class="confluenceTh"><span class="td-span"><span class="md-plain">Kernel Parameter</span></span></th><th class="confluenceTh"><span class="td-span"><span class="md-plain">Description</span></span></th><th class="confluenceTh"><span class="td-span"><span class="md-plain">Recommended Value</span></span></th></tr></thead><tbody><tr><td class="confluenceTd"><span class="td-span"><span class="md-plain">shmmax</span></span></td><td class="confluenceTd"><span class="td-span"><span class="md-plain">The maximum size of one shared memory segment</span></span></td><td class="confluenceTd"><span class="td-span"><span class="md-plain">2G + 1</span></span></td></tr><tr><td class="confluenceTd"><span class="td-span"><span class="md-plain">shmmni</span></span></td><td class="confluenceTd"><span class="td-span"><span class="md-plain">The maximum number of shared memory segments in the system</span></span></td><td class="confluenceTd"><span class="td-span"><span class="md-plain">500 or more</span></span></td></tr><tr><td class="confluenceTd"><span class="td-span"><span class="md-plain">shmseg</span></span></td><td class="confluenceTd"><span class="td-span"><span class="md-plain">The maximum number of processes that can access one shared memory</span></span></td><td class="confluenceTd"><span class="td-span"><span class="md-plain">200 or more</span></span></td></tr></tbody></table></div><h4 class="md-end-block md-heading" id="id-1.KernelParameters-ConsiderationsWhenLoadingMemoryDBintoSharedMemory"><span class="md-plain">Considerations When Loading Memory DB into Shared Memory</span></h4><p class="md-end-block md-p"><span class="md-plain">When loading a memory DB into shared memory, the following items should be additionally considered:</span></p><ul class="ul-list"><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">shmmax</span></p><p class="md-end-block md-p"><span class="md-plain">In case of shmmax, one segment is created as much as the size of the STARTUP_SHM_CHUNK_SIZE item in the Altibase configuration file during the operation phase, so set it to a value larger than STARTUP_SHM_CHUNK_SIZE.</span></p></li><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">Shmmni</span></p><p class="md-end-block md-p"><span class="md-plain">When memory DB usage increases, Altibase automatically increases the memory area. In this case, a set meant is also newly created. The size of this segment is set in the Altibase configuration file in EXPAND_CHUNK_PAGE_COUNT * 32K, so shmmni should be set as much as possible.</span></p></li></ul><h3 class="md-end-block md-heading" id="id-1.KernelParameters-Semaphore"><span class="md-plain">Semaphore</span></h3><p class="md-end-block md-p"><span class="md-plain">This is a kind of IPC resource like shared memory. The difference is that shared memory is provided as a way to share data between processes, while semaphores are resources provided by the operating system as a way to implement synchronization between processes. Synchronization means that only one process can access and change a specific resource or object at a time. (Unlike mutex, an inquiry is possible at the same time.)</span></p><p class="md-end-block md-p"><span class="md-plain">Altibase uses shared memory as a communication buffer between the two ends when an Altibase server and a client exist in the local server as described above. At this time, it is necessary to control the concurrency of the memory. (Because it should not write at the same time.)</span></p><p class="md-end-block md-p"><span class="md-plain">In this case, a semaphore operation occurs to control access to read/write access to memory.</span></p><p class="md-end-block md-p"><span class="md-plain">Depending on the semaphore operation, the process can go into a waiting state or a progress state. Since these semaphore operations occur simultaneously, it is necessary to set the appropriate number of semaphores and kernel parameters for the operation. </span></p><p class="md-end-block md-p"><span class="md-plain">The kernel parameters related to semaphore in the Unix system are as follows.</span></p><div class="table-wrap"><table class="confluenceTable"><thead><tr><th class="confluenceTh"><span class="td-span"><span class="md-plain">Kernel Parameter</span></span></th><th class="confluenceTh"><span class="td-span"><span class="md-plain">Description</span></span></th><th class="confluenceTh"><span class="td-span"><span class="md-plain">Recommended Value</span></span></th></tr></thead><tbody><tr><td class="confluenceTd"><span class="td-span"><span class="md-plain">semmns</span></span></td><td class="confluenceTd"><span class="td-span"><span class="md-plain">The maximum number semaphores in the system, and 16 bytes of kernel memory are allocated</span></span></td><td class="confluenceTd"><span class="td-span"><span class="md-plain">8192</span></span></td></tr><tr><td class="confluenceTd"><span class="td-span"><span class="md-plain">semmni</span></span></td><td class="confluenceTd"><span class="td-span"><span class="md-plain">The maximum number of semaphore sets can be set within 65535, and 84 bytes of kernel memory is allocated per set.</span></span></td><td class="confluenceTd"><span class="td-span"><span class="md-plain">5092</span></span></td></tr><tr><td class="confluenceTd"><span class="td-span"><span class="md-plain">semmsl</span></span></td><td class="confluenceTd"><span class="td-span"><span class="md-plain">The maximum number of semaphores in a set of semaphores and must be logically equal to or less than semmns. If set too large, several semaphore IDs can monopolize the entire system semaphore.</span></span></td><td class="confluenceTd"><span class="td-span"><span class="md-plain">2000</span></span></td></tr><tr><td class="confluenceTd"><span class="td-span"><span class="md-plain">semmap</span></span></td><td class="confluenceTd"><span class="td-span"><span class="md-plain">Semaphore space obtained by semget call</span></span></td><td class="confluenceTd"><span class="td-span"><span class="md-plain">5024</span></span></td></tr><tr><td class="confluenceTd"><span class="td-span"><span class="md-plain">semmnu</span></span></td><td class="confluenceTd"><span class="td-span"><span class="md-plain">The maximum number of undo structures in the system</span></span></td><td class="confluenceTd"><span class="td-span"><span class="md-plain">1024</span></span></td></tr><tr><td class="confluenceTd"><span class="td-span"><span class="md-plain">semopm</span></span></td><td class="confluenceTd"><span class="td-span"><span class="md-plain">The maximum number of operations processed by semop system call</span></span></td><td class="confluenceTd"><span class="td-span"><span class="md-plain">512</span></span></td></tr><tr><td class="confluenceTd"><span class="td-span"><span class="md-plain">semume</span></span></td><td class="confluenceTd"><span class="td-span"><span class="md-plain">The maximum number of undo entries per process</span></span></td><td class="confluenceTd"><span class="td-span"><span class="md-plain">512</span></span></td></tr><tr><td class="confluenceTd"><span class="td-span"><span class="md-plain">semvmx</span></span></td><td class="confluenceTd"><span class="td-span"><span class="md-plain">Limits the maximum value of one semaphore and does not specify a value greater than 32767</span></span></td><td class="confluenceTd"><span class="td-span"><span class="md-plain">32767</span></span></td></tr></tbody></table></div><h3 class="md-end-block md-heading" id="id-1.KernelParameters-HowtoChange"><span class="md-plain"><br />How to Change</span></h3><p class="md-end-block md-p"><span class="md-plain">In Solaris, kernel parameters are set through the /etc/system file. Starting from 5.10, kernel parameters can be applied to each user account by introducing a project concept in addition to the existing method.</span></p><p class="md-end-block md-p"><span class="md-plain md-expand">Here is an example of setting in both ways. Basically, access to the root account is required, and in order to apply properly, the system must be restarted after the change.</span></p><h4 class="md-end-block md-heading" id="id-1.KernelParameters-5.10orlater"><span class="md-plain">5.10 or later</span></h4><p class="md-end-block md-p md-focus"><span class="md-plain">In Solaris 5.10, some of the existing kernel parameter items have disappeared, so the user can run the configuration items related to shared memory and semaphores at the shell prompt using the Solaris utilities projadd and projmod.</span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: java; gutter: false" style="font-size:12px;"># projadd -U altibase -K &quot;project.max-sem-ids=(priv,5029,deny)&quot; user.altibase
# projmod -a -K &quot;project.max-shm-memory=(priv, maximum physical memory, deny)&quot; user.altibase
# projmod -a -K &quot;process.max-sem-nsems=(priv,2000,deny)&quot;  user.altibase
# projmod -a -K &quot;process.max-sem-ops=(priv,512,deny)&quot;  user.altibase
# projmod -a -K &quot;project.max-shm-ids=(priv,1024,deny)&quot; user.altibase
# projmod -a -K &quot;project.max-msg-messages=(priv,100,deny)&quot;  user.altibase
# projmod -a -K &quot;project.max-msg-ids=(priv,100,deny)&quot; user.altibase
# projmod -a -K &quot;process.max-msg-qbytes=(priv,1048576,deny)&quot; user.altibase</pre>
</div></div><p class="md-end-block md-p"><span class="md-plain">Note that max-shm-memory should be set the maximum value of physical memory.</span></p><p class="md-end-block md-p md-focus"><span class="md-plain">The user can check the setting change with the following command.</span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: java; gutter: false" style="font-size:12px;"># projadd –l</pre>
</div></div><p> </p><p class="md-end-block md-p md-focus"><span class="md-plain"><br /></span></p>
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Jun 23, 2021 09:49</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
