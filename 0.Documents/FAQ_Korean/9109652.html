<!DOCTYPE html>
<html>
    <head>
        <title>FAQ(한국어) : [Notify : Fetch Timeout] Session Closed by Server.</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">FAQ(한국어)</a></span>
                            </li>
                                                    <li>
                                <span><a href="Home_6062093.html">Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="6520894.html">09. 에러메시지</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            FAQ(한국어) : [Notify : Fetch Timeout] Session Closed by Server.
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
    
            Created by <span class='author'> heejung lee</span> on Aug 28, 2015
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p><style type='text/css'>/*<![CDATA[*/
div.rbtoc1624409054810 {padding: 0px;}
div.rbtoc1624409054810 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1624409054810 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1624409054810'>
<ul class='toc-indentation'>
<li><a href='#id-[Notify:FetchTimeout]SessionClosedbyServer.-개요'>개요</a></li>
<li><a href='#id-[Notify:FetchTimeout]SessionClosedbyServer.-버전'>버전</a></li>
<li><a href='#id-[Notify:FetchTimeout]SessionClosedbyServer.-현상'>현상</a>
<ul class='toc-indentation'>
<li><a href='#id-[Notify:FetchTimeout]SessionClosedbyServer.-알티베이스서버'>알티베이스 서버</a></li>
<li><a href='#id-[Notify:FetchTimeout]SessionClosedbyServer.-알티베이스클라이언트'>알티베이스 클라이언트</a>
<ul class='toc-indentation'>
<li><a href='#id-[Notify:FetchTimeout]SessionClosedbyServer.-OrangeforALTIBASE'>Orange for ALTIBASE</a></li>
<li><a href='#id-[Notify:FetchTimeout]SessionClosedbyServer.-iSQL'>iSQL</a></li>
<li><a href='#id-[Notify:FetchTimeout]SessionClosedbyServer.-APRE(SESC),SQLCLI,ODBC,CAPI'>APRE(SESC), SQLCLI, ODBC, CAPI</a></li>
<li><a href='#id-[Notify:FetchTimeout]SessionClosedbyServer.-JDBC'>JDBC</a></li>
</ul>
</li>
</ul>
</li>
<li><a href='#id-[Notify:FetchTimeout]SessionClosedbyServer.-원인'>원인</a></li>
<li><a href='#id-[Notify:FetchTimeout]SessionClosedbyServer.-조치'>조치</a>
<ul class='toc-indentation'>
<li><a href='#id-[Notify:FetchTimeout]SessionClosedbyServer.-응용프로그램로직확인'>응용 프로그램 로직 확인</a></li>
<li><a href='#id-[Notify:FetchTimeout]SessionClosedbyServer.-FETCH_TIMEOUT설정값변경'>FETCH_TIMEOUT 설정 값 변경</a>
<ul class='toc-indentation'>
<li><a href='#id-[Notify:FetchTimeout]SessionClosedbyServer.-세션프로퍼티변경'>세션 프로퍼티 변경</a></li>
<li><a href='#id-[Notify:FetchTimeout]SessionClosedbyServer.-시스템프로퍼티변경'>시스템 프로퍼티 변경</a></li>
<li><a href='#id-[Notify:FetchTimeout]SessionClosedbyServer.-FETCH_TIMEOUT프로퍼티값확인방법'>FETCH_TIMEOUT 프로퍼티 값 확인 방법</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div></p><p> </p><p> </p><p> </p><p> </p><h1 id="id-[Notify:FetchTimeout]SessionClosedbyServer.-개요"><strong>개요</strong></h1><hr /><p>Fetch Timeout 메시지에 대해 설명합니다.</p><p> </p><p> </p><p> </p><h1 id="id-[Notify:FetchTimeout]SessionClosedbyServer.-버전"><strong>버전</strong></h1><hr /><p>ALTIBASE HDB 모든 버전.</p><p> </p><p> </p><p> </p><h1 id="id-[Notify:FetchTimeout]SessionClosedbyServer.-현상"><strong>현상</strong></h1><hr /><h2 id="id-[Notify:FetchTimeout]SessionClosedbyServer.-알티베이스서버"><strong>알티베이스 서버<br /></strong></h2><hr /><p>알티베이스 서버 로그에서는 다음과 같은 로그를 볼 수 있습니다.</p><ul style="list-style-type: square;"><li>알티베이스 서버 로그($ALTIBASE_HOME/trc/altibase_boot.log)에서 확인합니다.</li><li>버전 별 출력 형태가 다르므로 아래 결과를 참고하세요.</li><li>로그 출력 시각, CLIENT_INFO, Caused by Query 를 종합적으로 확인하여 클라이언트 쪽 현상과 관련이 있는지 확인합니다.</li></ul><ul style="list-style-type: square;"><li><p><strong>ALTIBASE HDB 5 이상</strong></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>ALTIBASE HDB 5 버전부터</b></div><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: bash; gutter: false" style="font-size:12px;">[2015/04/10 15:48:28] [Thread-1] [Level-1]
[Notify : Fetch Timeout] Session Closed by Server : Session ID = 32
    CLIENT_INFO           =&gt; TCP 127.0.0.1:50696(PID : 18647665)
    Time Limit            =&gt; 1
    Running Time          =&gt; 2
    Caused by Query       =&gt; SELECT * FROM EMP
    Transaction ID        =&gt; 544259</pre>
</div></div></li></ul><ul style="list-style-type: square;"><li><p><strong>ALTIBASE HDB 4.3.9<br /></strong></p><p>ALTIBASE HDB 4.3.9 의 알티베이스 서버 로그에서는 클라이언트 IP 정보를 확인할 수 없습니다. 로그 출력 시각과 Caused by Query 를 통해 판단해야 합니다.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>ALTIBASE HDB 4.3.9 </b></div><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: bash; gutter: false" style="font-size:12px;">[2015/04/10 15:44:56] [Thread-139708873230080] [Level-1]
[Notify : Fetch Timeout] Session Closed by Server : Session ID = 45
[2015/04/10 15:44:56] [Thread-139708873230080] [Level-1]
         Time   Limit =&gt; 2
         Running Time =&gt; 2
[2015/04/10 15:44:56] [Thread-139708873230080] [Level-1]
         Caused by Query =&gt; SELECT * FROM EMP
[2015/04/10 15:44:56] [Thread-139708873230080] [Level-1]
         Transaction ID =&gt; 26435</pre>
</div></div></li></ul><p> </p><p> </p><p> </p><p> </p><p> </p><h2 id="id-[Notify:FetchTimeout]SessionClosedbyServer.-알티베이스클라이언트"><strong>알티베이스 클라이언트</strong></h2><hr /><p>알티베이스 클라이언트 쪽에서 아래와 같은 현상이 발생합니다.</p><ul><li>클라이언트에서 알티베이스 서버로 요청을 보내는 시점에 에러 메시지를 확인할 수 있습니다.<br />따라서 알티베이스 서버 측(altibase_boot.log) 에 남겨진 시각보다 이후에 발생할 수 있습니다.</li><li>SELECT 중(Fetch 요청 시) 알티베이스 서버와의 연결이 끊어집니다.</li><li>Fetch 결과를 가지고 어플리케이션에서 처리하다가 다시 데이터베이스로 FETCH 를 요청할 때 연결이 끊긴 에러가 발생합니다.</li><li>클라이언트 로그에 The session has been closed by the server 메시지가 보입니다. (ALTIBASE HDB 5.5.1 이상 버전에 해당)</li><li>클라이언트 로그에 Server closed the connection. 메시지가 보입니다. (ALTIBASE HDB 5.5.1 이상 버전에 해당.)<br /><br /></li></ul><p>클라이언트 별 에러 메시지 종류는 아래를 참고하세요.</p><h3 id="id-[Notify:FetchTimeout]SessionClosedbyServer.-OrangeforALTIBASE">Orange for ALTIBASE</h3><ul style="list-style-type: square;"><li><p>SELECT 수행 후 아래 결과 창의 스크롤을 내릴 때 아래의 에러 메시지가 발생합니다.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Orange for ALTIBASE</b></div><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: bash; gutter: false" style="font-size:12px;">Error : # 331843, Communication link failure. Server closed the connection.</pre>
</div></div></li></ul><h3 id="id-[Notify:FetchTimeout]SessionClosedbyServer.-iSQL">iSQL</h3><ul style="list-style-type: square;"><li><p>iSQL 에서 SELECT 수행 중 아래의 에러 메시지가 발생합니다.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>iSQL</b></div><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;">iSQL&gt; select * from emp;
...중략...
11          1003        2750000     
12          4002        1890000     
[ERR-91015 : Communication failure.]
</pre>
</div></div></li></ul><h3 id="id-[Notify:FetchTimeout]SessionClosedbyServer.-APRE(SESC),SQLCLI,ODBC,CAPI">APRE(SESC), SQLCLI, ODBC, CAPI</h3><ul style="list-style-type: square;"><li><p>APRE, SQLCLI, ODBC, CAPI 에서는 Fetch 중 Communication link failure. Server closed the connection. 이 발생합니다. </p><p>ALTIBASE HDB 5 부터 해당됩니다.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>APRE</b></div><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: bash; gutter: false" style="font-size:12px;">FETCH ERROR         : [-331843] Communication link failure. Server closed the connection.
</pre>
</div></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>SQLCLI, ODBC</b></div><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: bash; gutter: false" style="font-size:12px;">Error : SELECT * FROM EMP
Diagnostic Record 1
     SQLSTATE     : 08S01
     Message text : Communication link failure. Server closed the connection.
     Message len  : 57
     Native error : 0x51043</pre>
</div></div></li></ul><ul style="list-style-type: square;"><li><p>SESC (ALTIBASE HDB 4 ~ 5.1.5)</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>SESC</b></div><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: bash; gutter: false" style="font-size:12px;">$ ./cursor2
...중략...
16      1001     2300000.00
17      2001     1400000.00
FETCH ERROR              : [-331843] Communication link failure (0
CURSOR CLOSE ERROR Error : [-594098] Connection does not exist
DISCONN ERROR            : [0] </pre>
</div></div></li></ul><h3 id="id-[Notify:FetchTimeout]SessionClosedbyServer.-JDBC">JDBC</h3><ul style="list-style-type: square;"><li><p><strong>ALTIBASE HDB 4.3.9</strong> 에서는 FETCH 수행 중 아래와 같이 에러가 발생하며 애플리케이션이 중단될 수 있습니다.</p><div class="panel" style="border-color: grey;border-style: dotted;border-width: 1px;"><div class="panelContent">
<p>$ java SimpleSQL<br />...중략...<br />  ENO, DNO, SALARY : 20 40020<br />FETCH ERROR CODE    : 0<br />FETCH ERROR MESSAGE : Altibase JDBC $Revision: 24725 $<span style="color: rgb(255,0,0);"> ERROR:read time out</span><br />java.sql.SQLException: Altibase JDBC $Revision: 24725 $ ERROR:read time out<br />        at Altibase.jdbc.driver.cmProtocol.fireIOError(cmProtocol.java:87)<br />        at Altibase.jdbc.driver.cmProtocolTCP.execFetch(cmProtocolTCP.java:817)<br />        at Altibase.jdbc.driver.AltibaseConnection.execFetch(AltibaseConnection.java:298)<br />        at Altibase.jdbc.driver.<span style="color: rgb(255,0,0);">AltibaseResultSet.next</span>(AltibaseResultSet.java:1126)<br />        at SimpleSQL.main(SimpleSQL.java:105)</p>
</div></div></li><li><p><strong>ALTIBASE HDB 5 버전</strong>부터 6.1.1 까지는 FETCH 중 에러가 발생하고 이후 애플리케이션에서 알티베이스 서버로 요청을 보낼 때마다 연결 단절 에러가 발생합니다.</p><div class="panel" style="background-color: white;border-color: grey;border-style: dotted;border-width: 1px;"><div class="panelHeader" style="border-bottom-width: 1px;border-bottom-style: dotted;border-bottom-color: grey;background-color: greywhite;"><b>JDBC - ALTIBASE HDB 5, 6.1.1 발생 유형 1</b></div><div class="panelContent" style="background-color: white;">
<p>$ java SimpleSQL<br />...중략...<br />  ENO, DNO, SALARY : 19 40021800000<br />  ENO, DNO, SALARY : 20 40020<br />FETCH ERROR CODE    : 0<br />FETCH ERROR MESSAGE : <span style="color: rgb(255,0,0);">연결이 peer에 의해 재설정됩니다.</span> (errno:232)<br />java.sql.SQLException: 연결이 peer에 의해 재설정됩니다. (errno:232)<br />        at Altibase.jdbc.driver.ex.exception(ex.java:52)<br />        at Altibase.jdbc.driver.ex.exception(ex.java:37)<br />        at Altibase.jdbc.driver.cmnTCP.recv(cmnTCP.java:130)<br />        at Altibase.jdbc.driver.cmp.flush(cmp.java:247)<br />        at Altibase.jdbc.driver.cmp.writeFetchRequest(cmp.java:1066)<br />        at Altibase.jdbc.driver.ABConnection.writeFetchRequest(ABConnection.java:335)<br />        at Altibase.jdbc.driver.ABResultSet.fetchPosition(ABResultSet.java:1184)<br />        at Altibase.jdbc.driver.<span style="color: rgb(255,0,0);">ABResultSet.next</span>(ABResultSet.java:719)<br />        at SimpleSQL.main(SimpleSQL.java:105)<br />sPreStmt.close ERROR CODE    : 0<br />sPreStmt.close ERROR MESSAGE : <span style="color: rgb(255,0,0);">파이프가 손상되었습니다</span>. (errno:32)<br />java.sql.SQLException: 파이프가 손상되었습니다. (errno:32)<br />        at Altibase.jdbc.driver.ex.exception(ex.java:52)<br />        at Altibase.jdbc.driver.ex.exception(ex.java:37)<br />        at Altibase.jdbc.driver.cmnTCP.send(cmnTCP.java:153)<br />        at Altibase.jdbc.driver.cmp.flush(cmp.java:246)<br />        at Altibase.jdbc.driver.cmp.free(cmp.java:1085)<br />        at Altibase.jdbc.driver.ABConnection.free(ABConnection.java:346)<br />        at Altibase.jdbc.driver.<span style="color: rgb(255,0,0);">ABStatement.close</span>(ABStatement.java:174)<br />        at SimpleSQL.main(SimpleSQL.java:133)<br />sCon.close ERROR CODE    : 0<br />sCon.close ERROR MESSAGE : <span style="color: rgb(255,0,0);">파이프가 손상되었습니다</span>. (errno:32)<br />java.sql.SQLException: 파이프가 손상되었습니다. (errno:32)<br />        at Altibase.jdbc.driver.ex.exception(ex.java:52)<br />        at Altibase.jdbc.driver.ex.exception(ex.java:37)<br />        at Altibase.jdbc.driver.cmnTCP.send(cmnTCP.java:153)<br />        at Altibase.jdbc.driver.cmp.flush(cmp.java:246)<br />        at Altibase.jdbc.driver.cmp.disconnect(cmp.java:775)<br />        at Altibase.jdbc.driver.<span style="color: rgb(255,0,0);">ABConnection.clos</span>e(ABConnection.java:226)        <br />        at SimpleSQL.main(SimpleSQL.java:142)</p>
</div></div><div class="panel" style="background-color: white;border-color: grey;border-style: dotted;border-width: 1px;"><div class="panelHeader" style="border-bottom-width: 1px;border-bottom-style: dotted;border-bottom-color: grey;background-color: greywhite;"><b>JDBC - ALTIBASE HDB 5, 6.1.1 발생 유형 2</b></div><div class="panelContent" style="background-color: white;">
<p>$ java SimpleSQL<br />...중략...<br />  ENO, DNO, SALARY : 19 40021800000<br />  ENO, DNO, SALARY : 20 40020<br />FETCH ERROR CODE    : 331817<br />FETCH ERROR MESSAGE : <span style="color: rgb(255,0,0);">Communication link failure</span><br />java.sql.SQLException: Communication link failure<br />        at Altibase.jdbc.driver.ex.exception(ex.java:57)<br />        at Altibase.jdbc.driver.ex.exception(ex.java:32)<br />        at Altibase.jdbc.driver.ex.test(ex.java:83)<br />        at Altibase.jdbc.driver.cmnTCP.recv(cmnTCP.java:110)<br />        at Altibase.jdbc.driver.cmp.flush(cmp.java:253)<br />        at Altibase.jdbc.driver.cmp.writeFetchRequest(cmp.java:1167)<br />        at Altibase.jdbc.driver.ABConnection.writeFetchRequest(ABConnection.java:628)<br />        at Altibase.jdbc.driver.ABResultSet.fetchPosition(ABResultSet.java:1184)<br />        at Altibase.jdbc.driver.<span style="color: rgb(255,0,0);">ABResultSet.next</span>(ABResultSet.java:719)<br />        at SimpleSQL.main(SimpleSQL.java:105)<br />sPreStmt.close ERROR CODE    : 331817<br />sPreStmt.close ERROR MESSAGE : <span style="color: rgb(255,0,0);">Broken pipe</span><br />java.sql.SQLException: Broken pipe<br />        at Altibase.jdbc.driver.ex.exception(ex.java:76)<br />        at Altibase.jdbc.driver.cmnTCP.send(cmnTCP.java:156)<br />        at Altibase.jdbc.driver.cmp.flush(cmp.java:252)<br />        at Altibase.jdbc.driver.cmp.free(cmp.java:1186)<br />        at Altibase.jdbc.driver.ABConnection.free(ABConnection.java:655)<br />        at Altibase.jdbc.driver<span style="color: rgb(255,0,0);">.ABStatement.close</span>(ABStatement.java:179)<br />        at SimpleSQL.main(SimpleSQL.java:134)<br />Caused by: <a href="http://java.io" class="external-link" rel="nofollow">java.io</a>.IOException: Broken pipe<br />        at <a href="http://sun.nio.ch" class="external-link" rel="nofollow">sun.nio.ch</a>.FileDispatcher.write0(Native Method)<br />        at <a href="http://sun.nio.ch" class="external-link" rel="nofollow">sun.nio.ch</a>.SocketDispatcher.write(SocketDispatcher.java:29)<br />        at <a href="http://sun.nio.ch" class="external-link" rel="nofollow">sun.nio.ch</a>.IOUtil.writeFromNativeBuffer(IOUtil.java:69)<br />        at <a href="http://sun.nio.ch" class="external-link" rel="nofollow">sun.nio.ch</a>.IOUtil.write(IOUtil.java:26)<br />        at <a href="http://sun.nio.ch" class="external-link" rel="nofollow">sun.nio.ch</a>.SocketChannelImpl.write(SocketChannelImpl.java:336)<br />        at Altibase.jdbc.driver.cmnTCP.send(cmnTCP.java:147)<br />        ... 5 more<br />sCon.close ERROR CODE    : 331817<br />sCon.close ERROR MESSAGE : <span style="color: rgb(255,0,0);">Broken pipe</span><br />java.sql.SQLException: Broken pipe<br />        at Altibase.jdbc.driver.ex.exception(ex.java:76)<br />        at Altibase.jdbc.driver.cmnTCP.send(cmnTCP.java:156)<br />        at Altibase.jdbc.driver.cmp.flush(cmp.java:252)<br />        at Altibase.jdbc.driver.cmp.disconnect(cmp.java:877)<br />        at Altibase.jdbc.driver.<span style="color: rgb(255,0,0);">ABConnection.close</span>(ABConnection.java:366)<br />        at SimpleSQL.main(SimpleSQL.java:143)<br />Caused by: <a href="http://java.io" class="external-link" rel="nofollow">java.io</a>.IOException: Broken pipe<br />        at <a href="http://sun.nio.ch" class="external-link" rel="nofollow">sun.nio.ch</a>.FileDispatcher.write0(Native Method)<br />        at <a href="http://sun.nio.ch" class="external-link" rel="nofollow">sun.nio.ch</a>.SocketDispatcher.write(SocketDispatcher.java:29)<br />        at <a href="http://sun.nio.ch" class="external-link" rel="nofollow">sun.nio.ch</a>.IOUtil.writeFromNativeBuffer(IOUtil.java:69)<br />        at <a href="http://sun.nio.ch" class="external-link" rel="nofollow">sun.nio.ch</a>.IOUtil.write(IOUtil.java:26)<br />        at <a href="http://sun.nio.ch" class="external-link" rel="nofollow">sun.nio.ch</a>.SocketChannelImpl.write(SocketChannelImpl.java:336)<br />        at Altibase.jdbc.driver.cmnTCP.send(cmnTCP.java:147)<br />        ... 4 more</p>
</div></div></li><li><p><strong>ALTIBASE HDB 6.3.1 부터</strong>는 FETCH 수행 중 The session has been closed by the server 에러 메시지가 발생하고 알티베이스 서버로 요청을 보낼 때마다 연결 단절 에러가 발생합니다.</p><div class="panel" style="background-color: white;border-color: grey;border-style: dotted;border-width: 1px;"><div class="panelHeader" style="border-bottom-width: 1px;border-bottom-style: dotted;border-bottom-color: grey;background-color: writegrey;"><b>JDBC - ALTIBASE HDB 6.3.1</b></div><div class="panelContent" style="background-color: white;">
<p>FETCH ERROR CODE    : 4163<br />FETCH ERROR MESSAGE : <span style="color: rgb(255,0,0);">The session has been closed by the server</span><br />java.sql.SQLException: The session has been closed by the server<br />        at Altibase.jdbc.driver.ex.Error.processServerError(Error.java:320)<br />        at Altibase.jdbc.driver.AltibaseForwardOnly<span style="color: rgb(255,0,0);">ResultSet.next</span>(AltibaseForwardOnlyResultSet.java:151)<br />        at SimpleSQL.main(SimpleSQL.java:105)<br />sPreStmt.close ERROR CODE    : 334337<br />sPreStmt.close ERROR MESSAGE : <span style="color: rgb(255,0,0);">Communication link failure: There was no response from the server, and the channel has reached end-of-stream.</span><br />java.sql.SQLException: Communication link failure: There was no response from the server, and the channel has reached end-of-stream.<br />        at Altibase.jdbc.driver.ex.Error.throwSQLExceptionInternal(Error.java:162)<br />        at Altibase.jdbc.driver.ex.Error.throwSQLException(Error.java:102)<br />        at <a href="http://Altibase.jdbc.driver.cm" class="external-link" rel="nofollow">Altibase.jdbc.driver.cm</a>.CmChannel.readFromSocket(CmChannel.java:1042)<br />        at <a href="http://Altibase.jdbc.driver.cm" class="external-link" rel="nofollow">Altibase.jdbc.driver.cm</a>.CmChannel.receivePacket(CmChannel.java:1001)<br />        at <a href="http://Altibase.jdbc.driver.cm" class="external-link" rel="nofollow">Altibase.jdbc.driver.cm</a>.CmChannel.sendAndReceive(CmChannel.java:821)<br />        at <a href="http://Altibase.jdbc.driver.cm" class="external-link" rel="nofollow">Altibase.jdbc.driver.cm</a>.CmProtocol.freeStatement(CmProtocol.java:424)<br />        at Altibase.jdbc.driver.<span style="color: rgb(255,0,0);">AltibaseStatement.close</span>(AltibaseStatement.java:436)<br />        at SimpleSQL.main(SimpleSQL.java:133)<br />sCon.close ERROR CODE    : 334337<br />sCon.close ERROR MESSAGE : <span style="color: rgb(255,0,0);">Communication link failure: Broken pipe</span><br />java.sql.SQLException: Communication link failure: Broken pipe<br />        at Altibase.jdbc.driver.ex.Error.throwCommunicationErrorException(Error.java:237)<br />        at <a href="http://Altibase.jdbc.driver.cm" class="external-link" rel="nofollow">Altibase.jdbc.driver.cm</a>.CmChannel.sendPacket(CmChannel.java:921)<br />        at <a href="http://Altibase.jdbc.driver.cm" class="external-link" rel="nofollow">Altibase.jdbc.driver.cm</a>.CmChannel.sendAndReceive(CmChannel.java:819)<br />        at <a href="http://Altibase.jdbc.driver.cm" class="external-link" rel="nofollow">Altibase.jdbc.driver.cm</a>.CmProtocol.disconnect(CmProtocol.java:95)<br />        at Altibase.jdbc.driver.AltibaseConnection.disconnect(AltibaseConnection.java:616)<br />        at Altibase.jdbc.driver.<span style="color: rgb(255,0,0);">AltibaseConnection.close</span>(AltibaseConnection.java:601)<br />        at SimpleSQL.main(SimpleSQL.java:142)<br />Caused by: <a href="http://java.net" class="external-link" rel="nofollow">java.net</a>.SocketException: Broken pipe<br />        at <a href="http://java.net" class="external-link" rel="nofollow">java.net</a>.SocketOutputStream.socketWrite0(Native Method)<br />        at <a href="http://java.net" class="external-link" rel="nofollow">java.net</a>.SocketOutputStream.socketWrite(SocketOutputStream.java:109)<br />        at <a href="http://java.net" class="external-link" rel="nofollow">java.net</a>.SocketOutputStream.write(SocketOutputStream.java:153)<br />        at java.nio.channels.Channels$WritableByteChannelImpl.write(Channels.java:292)<br />        at <a href="http://Altibase.jdbc.driver.cm" class="external-link" rel="nofollow">Altibase.jdbc.driver.cm</a>.CmChannel.sendPacket(CmChannel.java:916)<br />        ... 5 more</p>
</div></div></li></ul><p> </p><p> </p><p> </p><p> </p><p> </p><h1 id="id-[Notify:FetchTimeout]SessionClosedbyServer.-원인"><strong>원인</strong></h1><hr /><p>세션 매니저(SessionManager) 가 FETCH_TMEOUT 에 걸린 세션을 정리하면서 남기는 알림성 메시지입니다.</p><p>FETCH_TMEOUT 는 알티베이스 서버 프로퍼티로 <a name="9005839" rel="nofollow"></a> SELECT 문을 수행하는 시간이 길어짐에 따라 DBMS 의 자원이 비정상적으로 증가하는 것을 막기 위하여 제공하는 프로퍼티입니다.</p><p>클라이언트에서 Fetch 요청하면 DBMS는 Fetch 결과를 일정량씩(통신 버퍼에) 나누어 클라이언트에게 전송합니다. 클라이언트는 통신 버퍼에 담긴 결과셋을 모두 읽으면 다음 결과셋을 DB 서버로 요청합니다.</p><p>다음 결과셋을 요청하는 시간 간격이 FETCH_TIMEOUT 설정 값을 초과할 경우 세션을 정리하고 수행 중이던 트랜잭션은 롤백됩니다.</p><p> </p><p>변경 트랜잭션에서 생성한 old image 를 조회 트랜잭션에서 바라보고 있을 경우 변경 트랜잭션이 종료해도 old image 가 정리되지 않습니다.</p><p>이런 이유로 SELECT 문이 장시간 수행될 경우 아래와 같이 <span><span style="color: rgb(51,51,51);">현상이 발생할 수 있습니다. </span></span></p><ul style="list-style-type: square;"><li>메모리 테이블의 경우 메모리 사용량 증가</li><li>디스크 테이블의 경우 언두 테이블스페이스 사용량 증가</li></ul><p> </p><p> </p><p> </p><p> </p><p> </p><h1 id="id-[Notify:FetchTimeout]SessionClosedbyServer.-조치"><strong>조치</strong></h1><hr /><h3 id="id-[Notify:FetchTimeout]SessionClosedbyServer.-응용프로그램로직확인">응용 프로그램 로직 확인</h3><ul style="list-style-type: square;"><li>FETCH_TIMEOUT은 주로 응용 프로그램에서 Fetch 결과를 가공하여 다른 작업을 수행하는데 이 처리 시간이 길어지는 경우 문제가 될 수 있습니다.</li><li><p>따라서, 응용 프로그램에서 Fetch 결과를 어떻게 처리하는 지 살펴보고 개선의 여지가 있는 지 파악 후 조치해야 합니다. ( 아래와 같은 부분이 있는 지 확인 후 조치)</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>JDBC 예</b></div><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: java; gutter: false" style="font-size:12px;">sRS = sStmt.executeQuery( &quot;SELECT EMP_FIRST, EMP_LAST,&quot; +
                          &quot; EMP_NO FROM TEST_EMP_TBL &quot; );
/* Fetch all data */
while( sRS.next() )
{
    /* Fetch 결과를 응용 프로그램에서 장시간 처리 */ 
}</pre>
</div></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>ARPE 예</b></div><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: cpp; gutter: false" style="font-size:12px;">/* declare cursor */
EXEC SQL DECLARE DEPT_CUR CURSOR FOR
         SELECT *
         FROM DEPARTMENTS;

/* open cursor */
EXEC SQL OPEN DEPT_CUR;

/* fetch cursor in loop */
while(1)
{
    EXEC SQL FETCH DEPT_CUR INTO :s_department :s_dept_ind;
     /* Fetch 결과를 응용 프로그램에서 장시간 처리 */
}</pre>
</div></div></li></ul><p> </p><p> </p><p> </p><h3 id="id-[Notify:FetchTimeout]SessionClosedbyServer.-FETCH_TIMEOUT설정값변경">FETCH_TIMEOUT 설정 값 변경</h3><ul style="list-style-type: square;"><li>FETCH_TIMEOUT 프로퍼티 기본값은 60초입니다. 운영 환경 상 이 값이 작다고 판단되는 경우 변경하여 사용할 수 있습니다.</li><li>이 프로퍼티는 시스템 프로퍼티 또는 세션 프로퍼티로 변경할 수 있습니다.</li></ul><p> </p><h4 id="id-[Notify:FetchTimeout]SessionClosedbyServer.-세션프로퍼티변경"><strong>세션 프로퍼티 변경</strong></h4><ul style="list-style-type: square;"><li><p>세션 프로퍼티는 세션 단위로, ALTER SESSION 을 수행한 세션에서 적용되며 ALTER SESSION 을 수행한 이후에 수행된 쿼리에 적용됩니다.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>iSQL - 세션 프로퍼티 변경 방법</b></div><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;">iSQL&gt; ALTER SESSION SET FETCH_TIMEOUT = 600;   -- 값은 초 단위</pre>
</div></div></li><li><p>어플리케이션에서도 변경할 수 있습니다.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>JDBC  예</b></div><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: java; gutter: false" style="font-size:12px;">sStmt.execute( &quot;ALTER SESSION SET FETCH_TIMEOUT = 600&quot; );</pre>
</div></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>APRE/SESC 예</b></div><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: c#; gutter: false" style="font-size:12px;"> EXEC SQL ALTER SESSION SET ALTER SESSION SET FETCH_TIMEOUT = 600 ; </pre>
</div></div></li></ul><h4 id="id-[Notify:FetchTimeout]SessionClosedbyServer.-시스템프로퍼티변경"><strong>시스템 프로퍼티 변경</strong></h4><ul style="list-style-type: square;"><li><p>시스템 프로퍼티는 ALTER SYSTEM 을 수행 이후 접속된 세션에 영향을 미칩니다. </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>iSQL - 시스템 프로퍼티 변경 방법</b></div><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;">iSQL&gt; ALTER SYSTEM SET FETCH_TIMEOUT = 600;   -- 값은 초 단위</pre>
</div></div></li><li><p>변경한 시스템 프로퍼티 값을 알티베이스 서버 프로세스를 재 시작한 후에도 유지하려면 altibase.properties 파일을 수정해야 합니다.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>iSQL - 시스템 프로퍼티 변경 방법</b></div><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;">$ vi $ALTIBASE_HOME/conf/altibase.properties
FETCH_TIMEOUT  = 60</pre>
</div></div></li></ul><p> </p><h4 id="id-[Notify:FetchTimeout]SessionClosedbyServer.-FETCH_TIMEOUT프로퍼티값확인방법">FETCH_TIMEOUT 프로퍼티 값 확인 방법</h4><p> </p><p> </p><ul style="list-style-type: square;"><li><p><strong>세션에 적용된 프로퍼티 값 확인 방법</strong></p><p>FETCH_TIMEOUT 은 세션 단위로도 변경이 가능하기 때문에 세션마다 설정된 값이 다를 수 있습니다. <br />세션에 설정된 프로퍼티 값은 V$SESSION 에서 확인할 수 있습니다. </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>세션에 적용된 프로퍼티 값 확인 방법</b></div><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;">-- ALTIBASE HDB 5 이상
iSQL&gt; SELECT ID SESSION_ID, FETCH_TIME_LIMIT FROM V$SESSION WHERE ID = SESSION_ID();

-- ALTIBASE HDB 4.3.9 (나의 세션 ID를 알 수 없으므로 클라이언트 IP, PID 등으로 유추해야 함. 
iSQL&gt; SELECT ID SESSION_ID, DB_USERNAME, CLIENT_CONSTR, COMM_NAME, CLIENT_PID, FETCH_TIME_LIMIT FROM V$SESSION;

</pre>
</div></div></li><li><p><strong>시스템 프로퍼티 값 확인</strong> <br />ALTER SYSTEM 으로 변경하거나 altibase.properties 에 설정한 값은 V$PROPERTY 에서 확인 가능합니다. </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>세션에 적용된 프로퍼티 값 확인 방법</b></div><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;">iSQL&gt; SELECT NAME, VALUE1 FROM V$PROPERTY WHERE NAME = &#39;FETCH_TIMEOUT&#39;;
</pre>
</div></div></li></ul><pre> </pre><p> </p>
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Jun 23, 2021 09:44</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
